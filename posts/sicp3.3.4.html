<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>SICP3.3.4 A simulator for digital cirtuits</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/b53cc6ef9e9e352d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b53cc6ef9e9e352d.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-959cc2ac3c742fb4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-b654c501598b6a83.js" defer=""></script><script src="/_next/static/chunks/996-372da0b0d3708a80.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-e5a68c245444f298.js" defer=""></script><script src="/_next/static/ljkl2AcbKtPNE2wH_VFb3/_buildManifest.js" defer=""></script><script src="/_next/static/ljkl2AcbKtPNE2wH_VFb3/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><h1 id="top">Taras Bunyk</h1><nav><a href="/">Home</a><a href="http://bunyk.github.io/mandala/">Snowflake drawing</a><a href="/resume">Resume</a><a href="/pages/sudoku.html">Sudoku fall</a><a href="https://bunyk.wordpress.com/">Old blog (in Ukrainian)</a></nav><article><h1>SICP3.3.4 A simulator for digital cirtuits</h1><div><em>Published: 2022-11-08T18:19:15.000Z</em></div><div><p>I tried chapter 3.3.2 Representing queues, but it was easy and boring.</p>
<p>Solution to Exercise 3.21 looks like this:</p>
<pre><code class="hljs language-scheme">(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">print-queue</span> queue)
  (<span class="hljs-name"><span class="hljs-built_in">display</span></span> (<span class="hljs-name"><span class="hljs-built_in">car</span></span> queue))
)</code></pre>
<p>3.3.3 is even more boring, and I even not bothered to try if it's hard or easy. So I skipped them both. Still, here we have more than enough code.</p>
<p>But turned out that simulator of digital circuits uses queue data structure from there. And I made a bug in it's implementation, by forgetting to update the pointer at the end of the queue, which led me to a lot of debugging of circuits code, until I realized that bug is in queue code.</p>
<p>This chapter is very interesting not only because of digital circuits emulation, but also because you build your own event system. In particular something similar to <code>setTimeout</code> in JavasScript. It's also inspiring. Now I have an itch to build graphical circuits simulator, the one similar to <a href="https://github.com/SebLague/Digital-Logic-Sim">Digital-Logic-Sim</a> of Sebastian Lague. Or maybe play a game "<a href="https://store.steampowered.com/app/1444480/Turing_Complete/">Turing Complete</a>"</p>
<p>And I feel difference from other chapters: functions here were mostly called for side-effects, not to return values. So when you call something like full-adder, it does nothing, it just connects inputs with outputs. Then you set values for inputs, run the "event loop", and read values from outputs. Full-adder by itself returns nothing.</p>
<p>Also, in this chapter you could not test your solutions until you get to it's end, because implementation of some utilities like agenda is given only after they are used. So I'll give most exercises in one listing, so it could be run in scheme interpeter.</p>
<h2 id="code">Code</h2>
<pre><code class="hljs language-scheme"><span class="hljs-comment">;;;;;;;;;;;;;;;;;;;;;;;;; Wire</span>
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">make-wire</span>)
  (<span class="hljs-name"><span class="hljs-built_in">let</span></span> (
    (<span class="hljs-name">signal-value</span> false)
    (<span class="hljs-name">action-procedures</span> '())
  )
	(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">set-my-signal!</span> new-value)
	  (<span class="hljs-name"><span class="hljs-built_in">if</span></span> (<span class="hljs-name"><span class="hljs-built_in">not</span></span> (<span class="hljs-name"><span class="hljs-built_in">eq?</span></span> signal-value new-value))
		(<span class="hljs-name"><span class="hljs-built_in">begin</span></span> (<span class="hljs-name"><span class="hljs-built_in">set!</span></span> signal-value new-value)
			   (<span class="hljs-name">call-each</span> action-procedures)
		)
	  )
	  <span class="hljs-symbol">'done</span>
	)

	(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">accept-action-procedure!</span> proc)
	  (<span class="hljs-name"><span class="hljs-built_in">set!</span></span> action-procedures (<span class="hljs-name"><span class="hljs-built_in">cons</span></span> proc action-procedures))
	  (<span class="hljs-name">proc</span>) <span class="hljs-comment">; Exercise 3.31 asks why this is here</span>
	)
	(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">dispatch</span> m)
	  (<span class="hljs-name"><span class="hljs-built_in">cond</span></span> 
		((<span class="hljs-name"><span class="hljs-built_in">eq?</span></span> m <span class="hljs-symbol">'get-signal</span>) signal-value)
		((<span class="hljs-name"><span class="hljs-built_in">eq?</span></span> m <span class="hljs-symbol">'set-signal!</span>) set-my-signal!)
		((<span class="hljs-name"><span class="hljs-built_in">eq?</span></span> m <span class="hljs-symbol">'add-action!</span>) accept-action-procedure!)
		(<span class="hljs-name"><span class="hljs-built_in">else</span></span> (<span class="hljs-name">error</span> <span class="hljs-string">"Unknown operation on wire"</span> m))
	  )
	)
	dispatch
  )
)

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">call-each</span> procedures)
  (<span class="hljs-name"><span class="hljs-built_in">if</span></span> (<span class="hljs-name"><span class="hljs-built_in">null?</span></span> procedures)
	<span class="hljs-symbol">'done</span>
	(<span class="hljs-name"><span class="hljs-built_in">begin</span></span>
	  ((<span class="hljs-name"><span class="hljs-built_in">car</span></span> procedures))
	  (<span class="hljs-name">call-each</span> (<span class="hljs-name"><span class="hljs-built_in">cdr</span></span> procedures))
	)
  )
)

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">get-signal</span> wire)
  (<span class="hljs-name">wire</span> <span class="hljs-symbol">'get-signal</span>)
)
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">set-signal!</span> wire new-value)
  ((<span class="hljs-name">wire</span> <span class="hljs-symbol">'set-signal!</span>) new-value)
)
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">add-action!</span> wire procedure)
  ((<span class="hljs-name">wire</span> <span class="hljs-symbol">'add-action!</span>) procedure)
)

<span class="hljs-comment">;;;;;;;;;;;;;;;;;;;;;;;;; Agenda</span>

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">after-delay</span> delay action)
  (<span class="hljs-name">add-to-agenda!</span>
	(<span class="hljs-name"><span class="hljs-built_in">+</span></span> delay (<span class="hljs-name">current-time</span> the-agenda))
	action
	the-agenda
  )
)

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">propagate</span>)
  (<span class="hljs-name"><span class="hljs-built_in">if</span></span> (<span class="hljs-name">empty-agenda?</span> the-agenda)
	<span class="hljs-symbol">'done</span>
	(<span class="hljs-name"><span class="hljs-built_in">let</span></span> (
		(<span class="hljs-name">first-item</span> (<span class="hljs-name">first-agenda-item</span> the-agenda))
	)
	  <span class="hljs-comment">; (newline)</span>
	  <span class="hljs-comment">; (display "\ntime:") (display (current-time the-agenda))</span>
	  <span class="hljs-comment">; (display " processing ")</span>
	  <span class="hljs-comment">; (display first-item)</span>
	  (<span class="hljs-name">first-item</span>)
	  (<span class="hljs-name">remove-first-agenda-item!</span> the-agenda)
	  <span class="hljs-comment">; (display-agenda the-agenda)</span>
	  (<span class="hljs-name">propagate</span>)
	)
  )
)

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">probe</span> name wire)
  (<span class="hljs-name">add-action!</span> wire (<span class="hljs-name"><span class="hljs-built_in">lambda</span></span> ()
	(<span class="hljs-name"><span class="hljs-built_in">newline</span></span>)
	(<span class="hljs-name"><span class="hljs-built_in">display</span></span> (<span class="hljs-name">current-time</span> the-agenda))
	(<span class="hljs-name"><span class="hljs-built_in">display</span></span> <span class="hljs-string">" "</span>)
	(<span class="hljs-name"><span class="hljs-built_in">display</span></span> name)
	(<span class="hljs-name"><span class="hljs-built_in">display</span></span> <span class="hljs-string">" = "</span>)
	(<span class="hljs-name"><span class="hljs-built_in">display</span></span> (<span class="hljs-name">get-signal</span> wire))
  ))
)

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> make-time-segment cons)
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> segment-time car)
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> segment-queue cdr)

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">display-segment</span> segment)
  (<span class="hljs-name"><span class="hljs-built_in">newline</span></span>)
  (<span class="hljs-name"><span class="hljs-built_in">display</span></span> (<span class="hljs-name">segment-time</span> segment))
  (<span class="hljs-name"><span class="hljs-built_in">display</span></span> <span class="hljs-string">" "</span>)
  (<span class="hljs-name">print-queue</span> (<span class="hljs-name">segment-queue</span> segment))
)

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">make-agenda</span>)
  (<span class="hljs-name"><span class="hljs-built_in">list</span></span> <span class="hljs-number">0</span>)
)
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> current-time car) <span class="hljs-comment">; head of agenda list is current time</span>
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> set-current-time! set-car!)
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> segments cdr) <span class="hljs-comment">; the rest of agenda is segments</span>
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> set-segments! set-cdr!)
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">first-segment</span> agenda)
  (<span class="hljs-name"><span class="hljs-built_in">car</span></span> (<span class="hljs-name">segments</span> agenda))
)
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">rest-segments</span> agenda)
  (<span class="hljs-name"><span class="hljs-built_in">cdr</span></span> (<span class="hljs-name">segments</span> agenda))
)
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">empty-agenda?</span> agenda)
  (<span class="hljs-name"><span class="hljs-built_in">null?</span></span> (<span class="hljs-name">segments</span> agenda))
)

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">display-agenda</span> agenda) 
  (<span class="hljs-name"><span class="hljs-built_in">newline</span></span>)
  (<span class="hljs-name"><span class="hljs-built_in">display</span></span> <span class="hljs-string">"Time: "</span>)
  (<span class="hljs-name"><span class="hljs-built_in">display</span></span> (<span class="hljs-name">current-time</span> agenda))
  (<span class="hljs-name"><span class="hljs-built_in">display</span></span> <span class="hljs-string">"\nSegments:"</span>)
  (<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">display-segments</span> segments)
	(<span class="hljs-name"><span class="hljs-built_in">if</span></span> (<span class="hljs-name"><span class="hljs-built_in">null?</span></span> segments)
	  (<span class="hljs-name"><span class="hljs-built_in">display</span></span> <span class="hljs-string">"\nend.\n"</span>)
	  (<span class="hljs-name"><span class="hljs-built_in">begin</span></span> 
		(<span class="hljs-name">display-segment</span> (<span class="hljs-name"><span class="hljs-built_in">car</span></span> segments))
		(<span class="hljs-name">display-segments</span> (<span class="hljs-name"><span class="hljs-built_in">cdr</span></span> segments))
	  )
	)
  )
  (<span class="hljs-name">display-segments</span> (<span class="hljs-name">segments</span> agenda))
)

(<span class="hljs-name"><span class="hljs-built_in">load</span></span> <span class="hljs-string">"queue.scm"</span>)

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">add-to-agenda!</span> time action agenda)
  (<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">belongs-before?</span> segments)
	(<span class="hljs-name"><span class="hljs-built_in">or</span></span>
	  (<span class="hljs-name"><span class="hljs-built_in">null?</span></span> segments)
	  (<span class="hljs-name"><span class="hljs-built_in">&#x3C;</span></span> time (<span class="hljs-name">segment-time</span> (<span class="hljs-name"><span class="hljs-built_in">car</span></span> segments)))
	)
  )
  (<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">make-new-time-segment</span> time action)
	(<span class="hljs-name"><span class="hljs-built_in">let</span></span> ((<span class="hljs-name">q</span> (<span class="hljs-name">make-queue</span>)))
	  (<span class="hljs-name">insert-queue!</span> q action)
	  (<span class="hljs-name">make-time-segment</span> time q)
	)
  )
  (<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">add-to-segments!</span> segments)
	(<span class="hljs-name"><span class="hljs-built_in">if</span></span> (<span class="hljs-name"><span class="hljs-built_in">=</span></span> (<span class="hljs-name">segment-time</span> (<span class="hljs-name"><span class="hljs-built_in">car</span></span> segments)) time)
	  (<span class="hljs-name">insert-queue!</span> (<span class="hljs-name">segment-queue</span> (<span class="hljs-name"><span class="hljs-built_in">car</span></span> segments)) action)
	  (<span class="hljs-name"><span class="hljs-built_in">let</span></span> ((<span class="hljs-name">rest</span> (<span class="hljs-name"><span class="hljs-built_in">cdr</span></span> segments)))
		(<span class="hljs-name"><span class="hljs-built_in">if</span></span> (<span class="hljs-name">belongs-before?</span> rest)
		  (<span class="hljs-name"><span class="hljs-built_in">set-cdr!</span></span> segments
			(<span class="hljs-name"><span class="hljs-built_in">cons</span></span> (<span class="hljs-name">make-new-time-segment</span> time action) rest)
		  )
		  (<span class="hljs-name">add-to-segments!</span> rest)
		)
	  )
	)
  )
  (<span class="hljs-name"><span class="hljs-built_in">let</span></span> ((<span class="hljs-name">segments</span> (<span class="hljs-name">segments</span> agenda)))
	(<span class="hljs-name"><span class="hljs-built_in">if</span></span> (<span class="hljs-name">belongs-before?</span> segments)
	  (<span class="hljs-name">set-segments!</span>
		agenda
		(<span class="hljs-name"><span class="hljs-built_in">cons</span></span> (<span class="hljs-name">make-new-time-segment</span> time action) segments)
	  )
	  (<span class="hljs-name">add-to-segments!</span> segments)
	)
  )
  <span class="hljs-comment">; (display-agenda agenda)</span>
)

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">remove-first-agenda-item!</span> agenda)
  (<span class="hljs-name"><span class="hljs-built_in">let</span></span> ((<span class="hljs-name">q</span> (<span class="hljs-name">segment-queue</span> (<span class="hljs-name">first-segment</span> agenda))))
	(<span class="hljs-name">delete-queue!</span> q)
	(<span class="hljs-name"><span class="hljs-built_in">if</span></span> (<span class="hljs-name">empty-queue?</span> q)
	  (<span class="hljs-name">set-segments!</span> agenda (<span class="hljs-name">rest-segments</span> agenda))
	)
  )
  <span class="hljs-comment">; (display-agenda agenda)</span>
)

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">first-agenda-item</span> agenda)
  (<span class="hljs-name"><span class="hljs-built_in">if</span></span> (<span class="hljs-name">empty-agenda?</span> agenda)
	(<span class="hljs-name">error</span> <span class="hljs-string">"No first-agenda-item in empty agenda"</span>)
	(<span class="hljs-name"><span class="hljs-built_in">let</span></span> ((<span class="hljs-name">first-seg</span> (<span class="hljs-name">first-segment</span> agenda)))
	  (<span class="hljs-name">set-current-time!</span> agenda (<span class="hljs-name">segment-time</span> first-seg))
	  (<span class="hljs-name">front-queue</span> (<span class="hljs-name">segment-queue</span> first-seg))
	)
  )
)

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> the-agenda (<span class="hljs-name">make-agenda</span>))

<span class="hljs-comment">;;;;;;;;;;;;;;;;;;;;;;;;; Gates</span>

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> inverter-delay <span class="hljs-number">2</span>)
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> and-gate-delay <span class="hljs-number">3</span>)
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> or-gate-delay <span class="hljs-number">5</span>)

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">inverter</span> input output)
  (<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">invert-input</span>) 
	(<span class="hljs-name"><span class="hljs-built_in">let</span></span> ((<span class="hljs-name">new-value</span> (<span class="hljs-name"><span class="hljs-built_in">not</span></span> (<span class="hljs-name">get-signal</span> input))))
	  (<span class="hljs-name">after-delay</span> inverter-delay
			(<span class="hljs-name"><span class="hljs-built_in">lambda</span></span> () (<span class="hljs-name">set-signal!</span> output new-value)))
	)
  )
  (<span class="hljs-name">add-action!</span> input invert-input)
  <span class="hljs-symbol">'ok</span>
)

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">and-gate</span> a1 a2 output)
  (<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">action-procedure</span>) 
	(<span class="hljs-name"><span class="hljs-built_in">let</span></span> (
		(<span class="hljs-name">new-value</span> (<span class="hljs-name"><span class="hljs-built_in">and</span></span> (<span class="hljs-name">get-signal</span> a1) (<span class="hljs-name">get-signal</span> a2)))
	)
	  	(<span class="hljs-name">after-delay</span> and-gate-delay
			(<span class="hljs-name"><span class="hljs-built_in">lambda</span></span> () (<span class="hljs-name">set-signal!</span> output new-value)))
	)
  )
  (<span class="hljs-name">add-action!</span> a1 action-procedure)
  (<span class="hljs-name">add-action!</span> a2 action-procedure)
  <span class="hljs-symbol">'ok</span>
)

<span class="hljs-comment">; Exercise 3.28</span>
<span class="hljs-comment">; (define (or-gate a1 a2 output)</span>
<span class="hljs-comment">;   (define (action-procedure) </span>
<span class="hljs-comment">; 	(let (</span>
<span class="hljs-comment">; 		(new-value (or (get-signal a1) (get-signal a2)))</span>
<span class="hljs-comment">; 	)</span>
<span class="hljs-comment">; 	  	(after-delay or-gate-delay</span>
<span class="hljs-comment">; 			(lambda () (set-signal! output new-value)))</span>
<span class="hljs-comment">; 	)</span>
<span class="hljs-comment">;   )</span>
<span class="hljs-comment">;   (add-action! a1 action-procedure)</span>
<span class="hljs-comment">;   (add-action! a2 action-procedure)</span>
<span class="hljs-comment">;   'ok</span>
<span class="hljs-comment">; )</span>

<span class="hljs-comment">; Exercise 3.29</span>
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">or-gate</span> a1 a2 output) 
  (<span class="hljs-name"><span class="hljs-built_in">let</span></span> (
	(<span class="hljs-name">na1</span> (<span class="hljs-name">make-wire</span>))
	(<span class="hljs-name">na2</span> (<span class="hljs-name">make-wire</span>))
	(<span class="hljs-name">no</span> (<span class="hljs-name">make-wire</span>))
  )
	(<span class="hljs-name">inverter</span> a1 na1)
	(<span class="hljs-name">inverter</span> a2 na2)
	(<span class="hljs-name">and-gate</span> na1 na2 no)
	(<span class="hljs-name">inverter</span> no output)
  )
  <span class="hljs-symbol">'ok</span>
)
<span class="hljs-comment">; delay should be 2 * inverter-delay + and-gate-delay</span>

<span class="hljs-comment">;;;;;;;;;;;;;;;;;;;;; Testing or-gate:</span>
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> input1 (<span class="hljs-name">make-wire</span>))
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> input2 (<span class="hljs-name">make-wire</span>))

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">check-inputs</span> i1 i2)
  (<span class="hljs-name">set-signal!</span> input1 i1)
  (<span class="hljs-name">set-signal!</span> input2 i2)
  (<span class="hljs-name">propagate</span>)
)
<span class="hljs-comment">; </span>
<span class="hljs-comment">; (define or-output (make-wire))</span>
<span class="hljs-comment">; (or-gate input1 input2 or-output)</span>
<span class="hljs-comment">; (probe 'or or-output)</span>
<span class="hljs-comment">; </span>
<span class="hljs-comment">; (check-inputs false false)</span>
<span class="hljs-comment">; (check-inputs true false)</span>
<span class="hljs-comment">; (check-inputs false true)</span>
<span class="hljs-comment">; (check-inputs true true)</span>


(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">half-adder</span> a b s c)
  (<span class="hljs-name"><span class="hljs-built_in">let</span></span> (
		(<span class="hljs-name">d</span> (<span class="hljs-name">make-wire</span>))
		(<span class="hljs-name">e</span> (<span class="hljs-name">make-wire</span>)))
	(<span class="hljs-name">or-gate</span> a b d)
	(<span class="hljs-name">and-gate</span> a b c)
	(<span class="hljs-name">inverter</span> c e)
	(<span class="hljs-name">and-gate</span> d e s)
  )
  <span class="hljs-symbol">'ok</span>
) <span class="hljs-comment">; Delay should be max(or-gate-delay, and-gate-delay + inverter-delay) + and-gate-delay</span>

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">full-adder</span> a b c-in sum c-out)
  (<span class="hljs-name"><span class="hljs-built_in">let</span></span> (
	(<span class="hljs-name">s</span> (<span class="hljs-name">make-wire</span>))
	(<span class="hljs-name">c1</span> (<span class="hljs-name">make-wire</span>))
	(<span class="hljs-name">c2</span> (<span class="hljs-name">make-wire</span>))
  )
	(<span class="hljs-name">half-adder</span> b c-in s c1)
	(<span class="hljs-name">half-adder</span> a s sum c2)
	(<span class="hljs-name">or-gate</span> c1 c2 c-out)
  )
  <span class="hljs-symbol">'ok</span>
)
) <span class="hljs-comment">; Delay should be max(or-gate-delay, and-gate-delay + inverter-delay) + and-gate-delay + or-gate-delay</span>

<span class="hljs-comment">; Exercise 3.30</span>

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">ripple-carry-adder</span> A B S c)
  (<span class="hljs-name"><span class="hljs-built_in">if</span></span> (<span class="hljs-name"><span class="hljs-built_in">null?</span></span> A) 
	(<span class="hljs-name">set-signal!</span> c false) <span class="hljs-comment">; Carry adder of 0 bits returns 0 carry</span>
	(<span class="hljs-name"><span class="hljs-built_in">let</span></span> (
	  (<span class="hljs-name">nc</span> (<span class="hljs-name">make-wire</span>))
	)
	  (<span class="hljs-name">ripple-carry-adder</span> (<span class="hljs-name"><span class="hljs-built_in">cdr</span></span> A) (<span class="hljs-name"><span class="hljs-built_in">cdr</span></span> B) (<span class="hljs-name"><span class="hljs-built_in">cdr</span></span> S) nc)
	  (<span class="hljs-name">full-adder</span> (<span class="hljs-name"><span class="hljs-built_in">car</span></span> a) (<span class="hljs-name"><span class="hljs-built_in">car</span></span> b) nc (<span class="hljs-name"><span class="hljs-built_in">car</span></span> S) c)
	)
  )
)
) <span class="hljs-comment">; Delay should be (max(or-gate-delay, and-gate-delay + inverter-delay) + and-gate-delay + or-gate-delay) * number of bits</span>

<span class="hljs-comment">;;;;;;;;;;;;;;;;;;;;;;;;; Testing ripple-carry-adder</span>

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">make-bus</span> bits) 
  (<span class="hljs-name"><span class="hljs-built_in">if</span></span> (<span class="hljs-name"><span class="hljs-built_in">=</span></span> bits <span class="hljs-number">0</span>)
	'()
	(<span class="hljs-name"><span class="hljs-built_in">cons</span></span> (<span class="hljs-name">make-wire</span>) (<span class="hljs-name">make-bus</span> (<span class="hljs-name"><span class="hljs-built_in">-</span></span> bits <span class="hljs-number">1</span>)))
  )
)
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">get-signals</span> bus)
  (<span class="hljs-name"><span class="hljs-built_in">map</span></span> get-signal bus)
)
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">set-signals!</span> bus signals)
  (<span class="hljs-name"><span class="hljs-built_in">map</span></span> set-signal! bus signals)
)

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> A (<span class="hljs-name">make-bus</span> <span class="hljs-number">4</span>))
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> B (<span class="hljs-name">make-bus</span> <span class="hljs-number">4</span>))
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> S (<span class="hljs-name">make-bus</span> <span class="hljs-number">4</span>))
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> c (<span class="hljs-name">make-wire</span>))
(<span class="hljs-name">ripple-carry-adder</span> A B S c)

(<span class="hljs-name">set-signals!</span> A (<span class="hljs-name"><span class="hljs-built_in">list</span></span> false false true true)) <span class="hljs-comment">; A = 3</span>
(<span class="hljs-name">set-signals!</span> B (<span class="hljs-name"><span class="hljs-built_in">list</span></span> false true false true)) <span class="hljs-comment">; B = 5</span>
(<span class="hljs-name">propagate</span>)
(<span class="hljs-name">get-signals</span> S) <span class="hljs-comment">; S = 8 t f f f</span>
(<span class="hljs-name">get-signal</span> c)

(<span class="hljs-name">set-signals!</span> A (<span class="hljs-name"><span class="hljs-built_in">list</span></span> true true true false)) <span class="hljs-comment">; A = 14</span>
(<span class="hljs-name">set-signals!</span> B (<span class="hljs-name"><span class="hljs-built_in">list</span></span> false false true false)) <span class="hljs-comment">; B = 2</span>
(<span class="hljs-name">propagate</span>)
(<span class="hljs-name">get-signals</span> S) <span class="hljs-comment">; S = 0</span>
(<span class="hljs-name">get-signal</span> c) <span class="hljs-comment">; c = 1</span></code></pre>
<h2 id="exercise-331">Exercise 3.31</h2>
<p>So, if we remove <code>proc</code> call from <code>accept-action-procedure!</code> and test half-adder, it returns wrong results for <code>false true</code>, and <code>true false</code> arguments.</p>
<pre><code class="hljs language-scheme">(<span class="hljs-name"><span class="hljs-built_in">define</span></span> sum (<span class="hljs-name">make-wire</span>))
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> carry (<span class="hljs-name">make-wire</span>))
(<span class="hljs-name">half-adder</span> input1 input2 sum carry)
(<span class="hljs-name">probe</span> <span class="hljs-symbol">'sum</span> sum)
(<span class="hljs-name">probe</span> <span class="hljs-symbol">'carry</span> carry)

(<span class="hljs-name">check-inputs</span> false false)
(<span class="hljs-name">check-inputs</span> true false)
(<span class="hljs-name">check-inputs</span> false true)
(<span class="hljs-name">check-inputs</span> true true)
(<span class="hljs-name">check-inputs</span> false true)</code></pre>
<p>It is because inverter inside it does not return inverted signal, while it should. It waits for input to first change, and then recalculates the signal.
That happens only after true true is given. For the inverter to work correctly with default wire signals, we need to set output signal when inverter is connected
This also applies to other gates. Since we could already have inverter or something else connected to a wire, that wire could have any value, so it's better to reevaluate output values.</p>
<h2 id="exercise-332">Exercise 3.32</h2>
<p>So, in and-gate, for each input wire we have added action that computes a new value that is logical and of both values, and after delay changes state of output wire.</p>
<p>Initially singals on wires are 0, 1, output is 0. Now we change first signal to 1.</p>
<p>Action is called, and new value is 1, because both wires are 1. We add to agenda function to set signal to 1</p>
<p>Then second value changes to 0. new-value is computed as 0, and new agenda function in queue will set signal to 0.</p>
<p>WITH FIFO, first signal is 1, but then 0, which is correct.</p>
<p>With LIFO, first signal changed to 0 (because that is last added value) and then to 1, so final state is not correct.</p>
<h2 id="code-for-queuescm">Code for queue.scm</h2>
<pre><code class="hljs language-scheme">(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">make-queue</span>)
  (<span class="hljs-name"><span class="hljs-built_in">cons</span></span> '() '())
)


(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">empty-queue?</span> queue)
  (<span class="hljs-name"><span class="hljs-built_in">null?</span></span> (<span class="hljs-name"><span class="hljs-built_in">car</span></span> queue))
)

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">insert-queue!</span> queue item)
  (<span class="hljs-name"><span class="hljs-built_in">let</span></span> ((<span class="hljs-name">new-pair</span> (<span class="hljs-name"><span class="hljs-built_in">cons</span></span> item '())))
	(<span class="hljs-name"><span class="hljs-built_in">cond</span></span>
	  ((<span class="hljs-name">empty-queue?</span> queue)
	   	(<span class="hljs-name"><span class="hljs-built_in">set-car!</span></span> queue new-pair)
	   	(<span class="hljs-name"><span class="hljs-built_in">set-cdr!</span></span> queue new-pair)
	  )
	  (<span class="hljs-name"><span class="hljs-built_in">else</span></span>
	    (<span class="hljs-name"><span class="hljs-built_in">set-cdr!</span></span> (<span class="hljs-name"><span class="hljs-built_in">cdr</span></span> queue) new-pair)
		(<span class="hljs-name"><span class="hljs-built_in">set-cdr!</span></span> queue new-pair)
	  )
	)
	queue
  )
)

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">delete-queue!</span> queue)
  (<span class="hljs-name"><span class="hljs-built_in">cond</span></span>
	((<span class="hljs-name">empty-queue?</span> queue) (<span class="hljs-name">error</span> <span class="hljs-string">"delete called with empty queue"</span>))
	(<span class="hljs-name"><span class="hljs-built_in">else</span></span>
	  (<span class="hljs-name"><span class="hljs-built_in">set-car!</span></span> queue (<span class="hljs-name"><span class="hljs-built_in">cdr</span></span> (<span class="hljs-name"><span class="hljs-built_in">car</span></span> queue)))
	  queue
	)
  )
)

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">front-queue</span> queue)
  (<span class="hljs-name"><span class="hljs-built_in">if</span></span> (<span class="hljs-name">empty-queue?</span> queue)
	(<span class="hljs-name">error</span> <span class="hljs-string">"No front-queue for empty queue"</span>)
	(<span class="hljs-name"><span class="hljs-built_in">car</span></span> (<span class="hljs-name"><span class="hljs-built_in">car</span></span> queue)) <span class="hljs-comment">; first element of front pointer</span>
  )
)

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">print-queue</span> queue)
  (<span class="hljs-name"><span class="hljs-built_in">display</span></span> (<span class="hljs-name"><span class="hljs-built_in">car</span></span> queue))
)</code></pre></div></article><div><div id="disqus_thread"></div></div><nav><a href="/">Home</a><a href="#top">Back to top</a></nav><footer>Â© <!-- -->2025<!-- --> Bunyk Taras. Built with Next.js</footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"sicp3.3.4","title":"SICP3.3.4 A simulator for digital cirtuits","date":"2022-11-08T18:19:15.000Z","tags":["SICP"],"updated_at":"2022-11-08T19:28:06+01:00","content":"\u003cp\u003eI tried chapter 3.3.2 Representing queues, but it was easy and boring.\u003c/p\u003e\n\u003cp\u003eSolution to Exercise 3.21 looks like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-scheme\"\u003e(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eprint-queue\u003c/span\u003e queue)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edisplay\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecar\u003c/span\u003e\u003c/span\u003e queue))\n)\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e3.3.3 is even more boring, and I even not bothered to try if it's hard or easy. So I skipped them both. Still, here we have more than enough code.\u003c/p\u003e\n\u003cp\u003eBut turned out that simulator of digital circuits uses queue data structure from there. And I made a bug in it's implementation, by forgetting to update the pointer at the end of the queue, which led me to a lot of debugging of circuits code, until I realized that bug is in queue code.\u003c/p\u003e\n\u003cp\u003eThis chapter is very interesting not only because of digital circuits emulation, but also because you build your own event system. In particular something similar to \u003ccode\u003esetTimeout\u003c/code\u003e in JavasScript. It's also inspiring. Now I have an itch to build graphical circuits simulator, the one similar to \u003ca href=\"https://github.com/SebLague/Digital-Logic-Sim\"\u003eDigital-Logic-Sim\u003c/a\u003e of Sebastian Lague. Or maybe play a game \"\u003ca href=\"https://store.steampowered.com/app/1444480/Turing_Complete/\"\u003eTuring Complete\u003c/a\u003e\"\u003c/p\u003e\n\u003cp\u003eAnd I feel difference from other chapters: functions here were mostly called for side-effects, not to return values. So when you call something like full-adder, it does nothing, it just connects inputs with outputs. Then you set values for inputs, run the \"event loop\", and read values from outputs. Full-adder by itself returns nothing.\u003c/p\u003e\n\u003cp\u003eAlso, in this chapter you could not test your solutions until you get to it's end, because implementation of some utilities like agenda is given only after they are used. So I'll give most exercises in one listing, so it could be run in scheme interpeter.\u003c/p\u003e\n\u003ch2 id=\"code\"\u003eCode\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-scheme\"\u003e\u003cspan class=\"hljs-comment\"\u003e;;;;;;;;;;;;;;;;;;;;;;;;; Wire\u003c/span\u003e\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-wire\u003c/span\u003e)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e\u003c/span\u003e (\n    (\u003cspan class=\"hljs-name\"\u003esignal-value\u003c/span\u003e false)\n    (\u003cspan class=\"hljs-name\"\u003eaction-procedures\u003c/span\u003e '())\n  )\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eset-my-signal!\u003c/span\u003e new-value)\n\t  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003enot\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eeq?\u003c/span\u003e\u003c/span\u003e signal-value new-value))\n\t\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ebegin\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eset!\u003c/span\u003e\u003c/span\u003e signal-value new-value)\n\t\t\t   (\u003cspan class=\"hljs-name\"\u003ecall-each\u003c/span\u003e action-procedures)\n\t\t)\n\t  )\n\t  \u003cspan class=\"hljs-symbol\"\u003e'done\u003c/span\u003e\n\t)\n\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eaccept-action-procedure!\u003c/span\u003e proc)\n\t  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eset!\u003c/span\u003e\u003c/span\u003e action-procedures (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003econs\u003c/span\u003e\u003c/span\u003e proc action-procedures))\n\t  (\u003cspan class=\"hljs-name\"\u003eproc\u003c/span\u003e) \u003cspan class=\"hljs-comment\"\u003e; Exercise 3.31 asks why this is here\u003c/span\u003e\n\t)\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003edispatch\u003c/span\u003e m)\n\t  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003econd\u003c/span\u003e\u003c/span\u003e \n\t\t((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eeq?\u003c/span\u003e\u003c/span\u003e m \u003cspan class=\"hljs-symbol\"\u003e'get-signal\u003c/span\u003e) signal-value)\n\t\t((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eeq?\u003c/span\u003e\u003c/span\u003e m \u003cspan class=\"hljs-symbol\"\u003e'set-signal!\u003c/span\u003e) set-my-signal!)\n\t\t((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eeq?\u003c/span\u003e\u003c/span\u003e m \u003cspan class=\"hljs-symbol\"\u003e'add-action!\u003c/span\u003e) accept-action-procedure!)\n\t\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eelse\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eerror\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"Unknown operation on wire\"\u003c/span\u003e m))\n\t  )\n\t)\n\tdispatch\n  )\n)\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ecall-each\u003c/span\u003e procedures)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003enull?\u003c/span\u003e\u003c/span\u003e procedures)\n\t\u003cspan class=\"hljs-symbol\"\u003e'done\u003c/span\u003e\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ebegin\u003c/span\u003e\u003c/span\u003e\n\t  ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecar\u003c/span\u003e\u003c/span\u003e procedures))\n\t  (\u003cspan class=\"hljs-name\"\u003ecall-each\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecdr\u003c/span\u003e\u003c/span\u003e procedures))\n\t)\n  )\n)\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eget-signal\u003c/span\u003e wire)\n  (\u003cspan class=\"hljs-name\"\u003ewire\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'get-signal\u003c/span\u003e)\n)\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eset-signal!\u003c/span\u003e wire new-value)\n  ((\u003cspan class=\"hljs-name\"\u003ewire\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'set-signal!\u003c/span\u003e) new-value)\n)\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eadd-action!\u003c/span\u003e wire procedure)\n  ((\u003cspan class=\"hljs-name\"\u003ewire\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'add-action!\u003c/span\u003e) procedure)\n)\n\n\u003cspan class=\"hljs-comment\"\u003e;;;;;;;;;;;;;;;;;;;;;;;;; Agenda\u003c/span\u003e\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eafter-delay\u003c/span\u003e delay action)\n  (\u003cspan class=\"hljs-name\"\u003eadd-to-agenda!\u003c/span\u003e\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e+\u003c/span\u003e\u003c/span\u003e delay (\u003cspan class=\"hljs-name\"\u003ecurrent-time\u003c/span\u003e the-agenda))\n\taction\n\tthe-agenda\n  )\n)\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003epropagate\u003c/span\u003e)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eempty-agenda?\u003c/span\u003e the-agenda)\n\t\u003cspan class=\"hljs-symbol\"\u003e'done\u003c/span\u003e\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e\u003c/span\u003e (\n\t\t(\u003cspan class=\"hljs-name\"\u003efirst-item\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003efirst-agenda-item\u003c/span\u003e the-agenda))\n\t)\n\t  \u003cspan class=\"hljs-comment\"\u003e; (newline)\u003c/span\u003e\n\t  \u003cspan class=\"hljs-comment\"\u003e; (display \"\\ntime:\") (display (current-time the-agenda))\u003c/span\u003e\n\t  \u003cspan class=\"hljs-comment\"\u003e; (display \" processing \")\u003c/span\u003e\n\t  \u003cspan class=\"hljs-comment\"\u003e; (display first-item)\u003c/span\u003e\n\t  (\u003cspan class=\"hljs-name\"\u003efirst-item\u003c/span\u003e)\n\t  (\u003cspan class=\"hljs-name\"\u003eremove-first-agenda-item!\u003c/span\u003e the-agenda)\n\t  \u003cspan class=\"hljs-comment\"\u003e; (display-agenda the-agenda)\u003c/span\u003e\n\t  (\u003cspan class=\"hljs-name\"\u003epropagate\u003c/span\u003e)\n\t)\n  )\n)\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eprobe\u003c/span\u003e name wire)\n  (\u003cspan class=\"hljs-name\"\u003eadd-action!\u003c/span\u003e wire (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003elambda\u003c/span\u003e\u003c/span\u003e ()\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003enewline\u003c/span\u003e\u003c/span\u003e)\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edisplay\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ecurrent-time\u003c/span\u003e the-agenda))\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edisplay\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\" \"\u003c/span\u003e)\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edisplay\u003c/span\u003e\u003c/span\u003e name)\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edisplay\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\" = \"\u003c/span\u003e)\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edisplay\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eget-signal\u003c/span\u003e wire))\n  ))\n)\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e make-time-segment cons)\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e segment-time car)\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e segment-queue cdr)\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003edisplay-segment\u003c/span\u003e segment)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003enewline\u003c/span\u003e\u003c/span\u003e)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edisplay\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003esegment-time\u003c/span\u003e segment))\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edisplay\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\" \"\u003c/span\u003e)\n  (\u003cspan class=\"hljs-name\"\u003eprint-queue\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003esegment-queue\u003c/span\u003e segment))\n)\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-agenda\u003c/span\u003e)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003elist\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n)\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e current-time car) \u003cspan class=\"hljs-comment\"\u003e; head of agenda list is current time\u003c/span\u003e\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e set-current-time! set-car!)\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e segments cdr) \u003cspan class=\"hljs-comment\"\u003e; the rest of agenda is segments\u003c/span\u003e\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e set-segments! set-cdr!)\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003efirst-segment\u003c/span\u003e agenda)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecar\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003esegments\u003c/span\u003e agenda))\n)\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003erest-segments\u003c/span\u003e agenda)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecdr\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003esegments\u003c/span\u003e agenda))\n)\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eempty-agenda?\u003c/span\u003e agenda)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003enull?\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003esegments\u003c/span\u003e agenda))\n)\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003edisplay-agenda\u003c/span\u003e agenda) \n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003enewline\u003c/span\u003e\u003c/span\u003e)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edisplay\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"Time: \"\u003c/span\u003e)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edisplay\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ecurrent-time\u003c/span\u003e agenda))\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edisplay\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"\\nSegments:\"\u003c/span\u003e)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003edisplay-segments\u003c/span\u003e segments)\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003enull?\u003c/span\u003e\u003c/span\u003e segments)\n\t  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edisplay\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"\\nend.\\n\"\u003c/span\u003e)\n\t  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ebegin\u003c/span\u003e\u003c/span\u003e \n\t\t(\u003cspan class=\"hljs-name\"\u003edisplay-segment\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecar\u003c/span\u003e\u003c/span\u003e segments))\n\t\t(\u003cspan class=\"hljs-name\"\u003edisplay-segments\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecdr\u003c/span\u003e\u003c/span\u003e segments))\n\t  )\n\t)\n  )\n  (\u003cspan class=\"hljs-name\"\u003edisplay-segments\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003esegments\u003c/span\u003e agenda))\n)\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eload\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"queue.scm\"\u003c/span\u003e)\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eadd-to-agenda!\u003c/span\u003e time action agenda)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ebelongs-before?\u003c/span\u003e segments)\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eor\u003c/span\u003e\u003c/span\u003e\n\t  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003enull?\u003c/span\u003e\u003c/span\u003e segments)\n\t  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e\u0026#x3C;\u003c/span\u003e\u003c/span\u003e time (\u003cspan class=\"hljs-name\"\u003esegment-time\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecar\u003c/span\u003e\u003c/span\u003e segments)))\n\t)\n  )\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-new-time-segment\u003c/span\u003e time action)\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003eq\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-queue\u003c/span\u003e)))\n\t  (\u003cspan class=\"hljs-name\"\u003einsert-queue!\u003c/span\u003e q action)\n\t  (\u003cspan class=\"hljs-name\"\u003emake-time-segment\u003c/span\u003e time q)\n\t)\n  )\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eadd-to-segments!\u003c/span\u003e segments)\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e=\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003esegment-time\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecar\u003c/span\u003e\u003c/span\u003e segments)) time)\n\t  (\u003cspan class=\"hljs-name\"\u003einsert-queue!\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003esegment-queue\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecar\u003c/span\u003e\u003c/span\u003e segments)) action)\n\t  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003erest\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecdr\u003c/span\u003e\u003c/span\u003e segments)))\n\t\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ebelongs-before?\u003c/span\u003e rest)\n\t\t  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eset-cdr!\u003c/span\u003e\u003c/span\u003e segments\n\t\t\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003econs\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-new-time-segment\u003c/span\u003e time action) rest)\n\t\t  )\n\t\t  (\u003cspan class=\"hljs-name\"\u003eadd-to-segments!\u003c/span\u003e rest)\n\t\t)\n\t  )\n\t)\n  )\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003esegments\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003esegments\u003c/span\u003e agenda)))\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ebelongs-before?\u003c/span\u003e segments)\n\t  (\u003cspan class=\"hljs-name\"\u003eset-segments!\u003c/span\u003e\n\t\tagenda\n\t\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003econs\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-new-time-segment\u003c/span\u003e time action) segments)\n\t  )\n\t  (\u003cspan class=\"hljs-name\"\u003eadd-to-segments!\u003c/span\u003e segments)\n\t)\n  )\n  \u003cspan class=\"hljs-comment\"\u003e; (display-agenda agenda)\u003c/span\u003e\n)\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eremove-first-agenda-item!\u003c/span\u003e agenda)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003eq\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003esegment-queue\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003efirst-segment\u003c/span\u003e agenda))))\n\t(\u003cspan class=\"hljs-name\"\u003edelete-queue!\u003c/span\u003e q)\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eempty-queue?\u003c/span\u003e q)\n\t  (\u003cspan class=\"hljs-name\"\u003eset-segments!\u003c/span\u003e agenda (\u003cspan class=\"hljs-name\"\u003erest-segments\u003c/span\u003e agenda))\n\t)\n  )\n  \u003cspan class=\"hljs-comment\"\u003e; (display-agenda agenda)\u003c/span\u003e\n)\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003efirst-agenda-item\u003c/span\u003e agenda)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eempty-agenda?\u003c/span\u003e agenda)\n\t(\u003cspan class=\"hljs-name\"\u003eerror\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"No first-agenda-item in empty agenda\"\u003c/span\u003e)\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003efirst-seg\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003efirst-segment\u003c/span\u003e agenda)))\n\t  (\u003cspan class=\"hljs-name\"\u003eset-current-time!\u003c/span\u003e agenda (\u003cspan class=\"hljs-name\"\u003esegment-time\u003c/span\u003e first-seg))\n\t  (\u003cspan class=\"hljs-name\"\u003efront-queue\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003esegment-queue\u003c/span\u003e first-seg))\n\t)\n  )\n)\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e the-agenda (\u003cspan class=\"hljs-name\"\u003emake-agenda\u003c/span\u003e))\n\n\u003cspan class=\"hljs-comment\"\u003e;;;;;;;;;;;;;;;;;;;;;;;;; Gates\u003c/span\u003e\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e inverter-delay \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e and-gate-delay \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e)\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e or-gate-delay \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e)\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003einverter\u003c/span\u003e input output)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003einvert-input\u003c/span\u003e) \n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003enew-value\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003enot\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eget-signal\u003c/span\u003e input))))\n\t  (\u003cspan class=\"hljs-name\"\u003eafter-delay\u003c/span\u003e inverter-delay\n\t\t\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003elambda\u003c/span\u003e\u003c/span\u003e () (\u003cspan class=\"hljs-name\"\u003eset-signal!\u003c/span\u003e output new-value)))\n\t)\n  )\n  (\u003cspan class=\"hljs-name\"\u003eadd-action!\u003c/span\u003e input invert-input)\n  \u003cspan class=\"hljs-symbol\"\u003e'ok\u003c/span\u003e\n)\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eand-gate\u003c/span\u003e a1 a2 output)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eaction-procedure\u003c/span\u003e) \n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e\u003c/span\u003e (\n\t\t(\u003cspan class=\"hljs-name\"\u003enew-value\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eand\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eget-signal\u003c/span\u003e a1) (\u003cspan class=\"hljs-name\"\u003eget-signal\u003c/span\u003e a2)))\n\t)\n\t  \t(\u003cspan class=\"hljs-name\"\u003eafter-delay\u003c/span\u003e and-gate-delay\n\t\t\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003elambda\u003c/span\u003e\u003c/span\u003e () (\u003cspan class=\"hljs-name\"\u003eset-signal!\u003c/span\u003e output new-value)))\n\t)\n  )\n  (\u003cspan class=\"hljs-name\"\u003eadd-action!\u003c/span\u003e a1 action-procedure)\n  (\u003cspan class=\"hljs-name\"\u003eadd-action!\u003c/span\u003e a2 action-procedure)\n  \u003cspan class=\"hljs-symbol\"\u003e'ok\u003c/span\u003e\n)\n\n\u003cspan class=\"hljs-comment\"\u003e; Exercise 3.28\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; (define (or-gate a1 a2 output)\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e;   (define (action-procedure) \u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; \t(let (\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; \t\t(new-value (or (get-signal a1) (get-signal a2)))\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; \t)\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; \t  \t(after-delay or-gate-delay\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; \t\t\t(lambda () (set-signal! output new-value)))\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; \t)\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e;   )\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e;   (add-action! a1 action-procedure)\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e;   (add-action! a2 action-procedure)\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e;   'ok\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; )\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e; Exercise 3.29\u003c/span\u003e\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eor-gate\u003c/span\u003e a1 a2 output) \n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e\u003c/span\u003e (\n\t(\u003cspan class=\"hljs-name\"\u003ena1\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-wire\u003c/span\u003e))\n\t(\u003cspan class=\"hljs-name\"\u003ena2\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-wire\u003c/span\u003e))\n\t(\u003cspan class=\"hljs-name\"\u003eno\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-wire\u003c/span\u003e))\n  )\n\t(\u003cspan class=\"hljs-name\"\u003einverter\u003c/span\u003e a1 na1)\n\t(\u003cspan class=\"hljs-name\"\u003einverter\u003c/span\u003e a2 na2)\n\t(\u003cspan class=\"hljs-name\"\u003eand-gate\u003c/span\u003e na1 na2 no)\n\t(\u003cspan class=\"hljs-name\"\u003einverter\u003c/span\u003e no output)\n  )\n  \u003cspan class=\"hljs-symbol\"\u003e'ok\u003c/span\u003e\n)\n\u003cspan class=\"hljs-comment\"\u003e; delay should be 2 * inverter-delay + and-gate-delay\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e;;;;;;;;;;;;;;;;;;;;; Testing or-gate:\u003c/span\u003e\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e input1 (\u003cspan class=\"hljs-name\"\u003emake-wire\u003c/span\u003e))\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e input2 (\u003cspan class=\"hljs-name\"\u003emake-wire\u003c/span\u003e))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003echeck-inputs\u003c/span\u003e i1 i2)\n  (\u003cspan class=\"hljs-name\"\u003eset-signal!\u003c/span\u003e input1 i1)\n  (\u003cspan class=\"hljs-name\"\u003eset-signal!\u003c/span\u003e input2 i2)\n  (\u003cspan class=\"hljs-name\"\u003epropagate\u003c/span\u003e)\n)\n\u003cspan class=\"hljs-comment\"\u003e; \u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; (define or-output (make-wire))\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; (or-gate input1 input2 or-output)\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; (probe 'or or-output)\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; \u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; (check-inputs false false)\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; (check-inputs true false)\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; (check-inputs false true)\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; (check-inputs true true)\u003c/span\u003e\n\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ehalf-adder\u003c/span\u003e a b s c)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e\u003c/span\u003e (\n\t\t(\u003cspan class=\"hljs-name\"\u003ed\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-wire\u003c/span\u003e))\n\t\t(\u003cspan class=\"hljs-name\"\u003ee\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-wire\u003c/span\u003e)))\n\t(\u003cspan class=\"hljs-name\"\u003eor-gate\u003c/span\u003e a b d)\n\t(\u003cspan class=\"hljs-name\"\u003eand-gate\u003c/span\u003e a b c)\n\t(\u003cspan class=\"hljs-name\"\u003einverter\u003c/span\u003e c e)\n\t(\u003cspan class=\"hljs-name\"\u003eand-gate\u003c/span\u003e d e s)\n  )\n  \u003cspan class=\"hljs-symbol\"\u003e'ok\u003c/span\u003e\n) \u003cspan class=\"hljs-comment\"\u003e; Delay should be max(or-gate-delay, and-gate-delay + inverter-delay) + and-gate-delay\u003c/span\u003e\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003efull-adder\u003c/span\u003e a b c-in sum c-out)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e\u003c/span\u003e (\n\t(\u003cspan class=\"hljs-name\"\u003es\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-wire\u003c/span\u003e))\n\t(\u003cspan class=\"hljs-name\"\u003ec1\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-wire\u003c/span\u003e))\n\t(\u003cspan class=\"hljs-name\"\u003ec2\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-wire\u003c/span\u003e))\n  )\n\t(\u003cspan class=\"hljs-name\"\u003ehalf-adder\u003c/span\u003e b c-in s c1)\n\t(\u003cspan class=\"hljs-name\"\u003ehalf-adder\u003c/span\u003e a s sum c2)\n\t(\u003cspan class=\"hljs-name\"\u003eor-gate\u003c/span\u003e c1 c2 c-out)\n  )\n  \u003cspan class=\"hljs-symbol\"\u003e'ok\u003c/span\u003e\n)\n) \u003cspan class=\"hljs-comment\"\u003e; Delay should be max(or-gate-delay, and-gate-delay + inverter-delay) + and-gate-delay + or-gate-delay\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e; Exercise 3.30\u003c/span\u003e\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eripple-carry-adder\u003c/span\u003e A B S c)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003enull?\u003c/span\u003e\u003c/span\u003e A) \n\t(\u003cspan class=\"hljs-name\"\u003eset-signal!\u003c/span\u003e c false) \u003cspan class=\"hljs-comment\"\u003e; Carry adder of 0 bits returns 0 carry\u003c/span\u003e\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e\u003c/span\u003e (\n\t  (\u003cspan class=\"hljs-name\"\u003enc\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-wire\u003c/span\u003e))\n\t)\n\t  (\u003cspan class=\"hljs-name\"\u003eripple-carry-adder\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecdr\u003c/span\u003e\u003c/span\u003e A) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecdr\u003c/span\u003e\u003c/span\u003e B) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecdr\u003c/span\u003e\u003c/span\u003e S) nc)\n\t  (\u003cspan class=\"hljs-name\"\u003efull-adder\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecar\u003c/span\u003e\u003c/span\u003e a) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecar\u003c/span\u003e\u003c/span\u003e b) nc (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecar\u003c/span\u003e\u003c/span\u003e S) c)\n\t)\n  )\n)\n) \u003cspan class=\"hljs-comment\"\u003e; Delay should be (max(or-gate-delay, and-gate-delay + inverter-delay) + and-gate-delay + or-gate-delay) * number of bits\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e;;;;;;;;;;;;;;;;;;;;;;;;; Testing ripple-carry-adder\u003c/span\u003e\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-bus\u003c/span\u003e bits) \n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e=\u003c/span\u003e\u003c/span\u003e bits \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n\t'()\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003econs\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-wire\u003c/span\u003e) (\u003cspan class=\"hljs-name\"\u003emake-bus\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e-\u003c/span\u003e\u003c/span\u003e bits \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)))\n  )\n)\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eget-signals\u003c/span\u003e bus)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003emap\u003c/span\u003e\u003c/span\u003e get-signal bus)\n)\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eset-signals!\u003c/span\u003e bus signals)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003emap\u003c/span\u003e\u003c/span\u003e set-signal! bus signals)\n)\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e A (\u003cspan class=\"hljs-name\"\u003emake-bus\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e))\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e B (\u003cspan class=\"hljs-name\"\u003emake-bus\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e))\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e S (\u003cspan class=\"hljs-name\"\u003emake-bus\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e))\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e c (\u003cspan class=\"hljs-name\"\u003emake-wire\u003c/span\u003e))\n(\u003cspan class=\"hljs-name\"\u003eripple-carry-adder\u003c/span\u003e A B S c)\n\n(\u003cspan class=\"hljs-name\"\u003eset-signals!\u003c/span\u003e A (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003elist\u003c/span\u003e\u003c/span\u003e false false true true)) \u003cspan class=\"hljs-comment\"\u003e; A = 3\u003c/span\u003e\n(\u003cspan class=\"hljs-name\"\u003eset-signals!\u003c/span\u003e B (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003elist\u003c/span\u003e\u003c/span\u003e false true false true)) \u003cspan class=\"hljs-comment\"\u003e; B = 5\u003c/span\u003e\n(\u003cspan class=\"hljs-name\"\u003epropagate\u003c/span\u003e)\n(\u003cspan class=\"hljs-name\"\u003eget-signals\u003c/span\u003e S) \u003cspan class=\"hljs-comment\"\u003e; S = 8 t f f f\u003c/span\u003e\n(\u003cspan class=\"hljs-name\"\u003eget-signal\u003c/span\u003e c)\n\n(\u003cspan class=\"hljs-name\"\u003eset-signals!\u003c/span\u003e A (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003elist\u003c/span\u003e\u003c/span\u003e true true true false)) \u003cspan class=\"hljs-comment\"\u003e; A = 14\u003c/span\u003e\n(\u003cspan class=\"hljs-name\"\u003eset-signals!\u003c/span\u003e B (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003elist\u003c/span\u003e\u003c/span\u003e false false true false)) \u003cspan class=\"hljs-comment\"\u003e; B = 2\u003c/span\u003e\n(\u003cspan class=\"hljs-name\"\u003epropagate\u003c/span\u003e)\n(\u003cspan class=\"hljs-name\"\u003eget-signals\u003c/span\u003e S) \u003cspan class=\"hljs-comment\"\u003e; S = 0\u003c/span\u003e\n(\u003cspan class=\"hljs-name\"\u003eget-signal\u003c/span\u003e c) \u003cspan class=\"hljs-comment\"\u003e; c = 1\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"exercise-331\"\u003eExercise 3.31\u003c/h2\u003e\n\u003cp\u003eSo, if we remove \u003ccode\u003eproc\u003c/code\u003e call from \u003ccode\u003eaccept-action-procedure!\u003c/code\u003e and test half-adder, it returns wrong results for \u003ccode\u003efalse true\u003c/code\u003e, and \u003ccode\u003etrue false\u003c/code\u003e arguments.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-scheme\"\u003e(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e sum (\u003cspan class=\"hljs-name\"\u003emake-wire\u003c/span\u003e))\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e carry (\u003cspan class=\"hljs-name\"\u003emake-wire\u003c/span\u003e))\n(\u003cspan class=\"hljs-name\"\u003ehalf-adder\u003c/span\u003e input1 input2 sum carry)\n(\u003cspan class=\"hljs-name\"\u003eprobe\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'sum\u003c/span\u003e sum)\n(\u003cspan class=\"hljs-name\"\u003eprobe\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'carry\u003c/span\u003e carry)\n\n(\u003cspan class=\"hljs-name\"\u003echeck-inputs\u003c/span\u003e false false)\n(\u003cspan class=\"hljs-name\"\u003echeck-inputs\u003c/span\u003e true false)\n(\u003cspan class=\"hljs-name\"\u003echeck-inputs\u003c/span\u003e false true)\n(\u003cspan class=\"hljs-name\"\u003echeck-inputs\u003c/span\u003e true true)\n(\u003cspan class=\"hljs-name\"\u003echeck-inputs\u003c/span\u003e false true)\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIt is because inverter inside it does not return inverted signal, while it should. It waits for input to first change, and then recalculates the signal.\nThat happens only after true true is given. For the inverter to work correctly with default wire signals, we need to set output signal when inverter is connected\nThis also applies to other gates. Since we could already have inverter or something else connected to a wire, that wire could have any value, so it's better to reevaluate output values.\u003c/p\u003e\n\u003ch2 id=\"exercise-332\"\u003eExercise 3.32\u003c/h2\u003e\n\u003cp\u003eSo, in and-gate, for each input wire we have added action that computes a new value that is logical and of both values, and after delay changes state of output wire.\u003c/p\u003e\n\u003cp\u003eInitially singals on wires are 0, 1, output is 0. Now we change first signal to 1.\u003c/p\u003e\n\u003cp\u003eAction is called, and new value is 1, because both wires are 1. We add to agenda function to set signal to 1\u003c/p\u003e\n\u003cp\u003eThen second value changes to 0. new-value is computed as 0, and new agenda function in queue will set signal to 0.\u003c/p\u003e\n\u003cp\u003eWITH FIFO, first signal is 1, but then 0, which is correct.\u003c/p\u003e\n\u003cp\u003eWith LIFO, first signal changed to 0 (because that is last added value) and then to 1, so final state is not correct.\u003c/p\u003e\n\u003ch2 id=\"code-for-queuescm\"\u003eCode for queue.scm\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-scheme\"\u003e(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-queue\u003c/span\u003e)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003econs\u003c/span\u003e\u003c/span\u003e '() '())\n)\n\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eempty-queue?\u003c/span\u003e queue)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003enull?\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecar\u003c/span\u003e\u003c/span\u003e queue))\n)\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003einsert-queue!\u003c/span\u003e queue item)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003elet\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003enew-pair\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003econs\u003c/span\u003e\u003c/span\u003e item '())))\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003econd\u003c/span\u003e\u003c/span\u003e\n\t  ((\u003cspan class=\"hljs-name\"\u003eempty-queue?\u003c/span\u003e queue)\n\t   \t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eset-car!\u003c/span\u003e\u003c/span\u003e queue new-pair)\n\t   \t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eset-cdr!\u003c/span\u003e\u003c/span\u003e queue new-pair)\n\t  )\n\t  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eelse\u003c/span\u003e\u003c/span\u003e\n\t    (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eset-cdr!\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecdr\u003c/span\u003e\u003c/span\u003e queue) new-pair)\n\t\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eset-cdr!\u003c/span\u003e\u003c/span\u003e queue new-pair)\n\t  )\n\t)\n\tqueue\n  )\n)\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003edelete-queue!\u003c/span\u003e queue)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003econd\u003c/span\u003e\u003c/span\u003e\n\t((\u003cspan class=\"hljs-name\"\u003eempty-queue?\u003c/span\u003e queue) (\u003cspan class=\"hljs-name\"\u003eerror\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"delete called with empty queue\"\u003c/span\u003e))\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eelse\u003c/span\u003e\u003c/span\u003e\n\t  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eset-car!\u003c/span\u003e\u003c/span\u003e queue (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecdr\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecar\u003c/span\u003e\u003c/span\u003e queue)))\n\t  queue\n\t)\n  )\n)\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003efront-queue\u003c/span\u003e queue)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eempty-queue?\u003c/span\u003e queue)\n\t(\u003cspan class=\"hljs-name\"\u003eerror\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"No front-queue for empty queue\"\u003c/span\u003e)\n\t(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecar\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecar\u003c/span\u003e\u003c/span\u003e queue)) \u003cspan class=\"hljs-comment\"\u003e; first element of front pointer\u003c/span\u003e\n  )\n)\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eprint-queue\u003c/span\u003e queue)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edisplay\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecar\u003c/span\u003e\u003c/span\u003e queue))\n)\u003c/code\u003e\u003c/pre\u003e"},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"sicp3.3.4"},"buildId":"ljkl2AcbKtPNE2wH_VFb3","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>