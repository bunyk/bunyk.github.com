<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>SICP 1.2.6 Primes</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/b53cc6ef9e9e352d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/b53cc6ef9e9e352d.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-514908bffb652963.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-6099a486a931d74e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9ca9bb1f507791d0.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-e383908e480c879a.js" defer=""></script><script src="/_next/static/BV4uJJEMRM41pRC-d7IhI/_buildManifest.js" defer=""></script><script src="/_next/static/BV4uJJEMRM41pRC-d7IhI/_ssgManifest.js" defer=""></script><script src="/_next/static/BV4uJJEMRM41pRC-d7IhI/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><h1 id="top">Taras Bunyk</h1><nav><a href="/">Home</a><a href="http://bunyk.github.io/mandala/">Snowflake drawing</a><a href="/resume">Resume</a><a href="https://bunyk.wordpress.com/">Old blog (in Ukrainian)</a></nav><article><h1>SICP 1.2.6 Primes</h1><div>Published: 2020-06-21</div><div><p>A little bit of number theory.</p>
<h2>Exercise 1.21: Smallest divisors</h2>
<p>This is so trivial, so I'll try to rewrite example, because it's just copypaste otherwise:</p>
<pre><code class="hljs language-scheme">(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">divisor?</span> d n) (<span class="hljs-name"><span class="hljs-built_in">=</span></span> (<span class="hljs-name"><span class="hljs-built_in">remainder</span></span> n d) <span class="hljs-number">0</span>))
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">smallest-divisor</span> n)
    (<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">find-divisor</span> n d)
        (<span class="hljs-name"><span class="hljs-built_in">cond</span></span> ((<span class="hljs-name"><span class="hljs-built_in">></span></span> (<span class="hljs-name">sqr</span> d) n) n)
            ((<span class="hljs-name">divisor?</span> d n) d)
            (<span class="hljs-name"><span class="hljs-built_in">else</span></span> (<span class="hljs-name">find-divisor</span> n (<span class="hljs-name"><span class="hljs-built_in">+</span></span> d <span class="hljs-number">1</span>)))
        )

    )
    (<span class="hljs-name">find-divisor</span> n <span class="hljs-number">2</span>)
)</code></pre>
<pre><code class="hljs language-scheme"><span class="hljs-number">1</span> ]=> (<span class="hljs-name">smallest-divisor</span> <span class="hljs-number">199</span>)

<span class="hljs-comment">;Value: 199</span>

<span class="hljs-number">1</span> ]=> (<span class="hljs-name">smallest-divisor</span> <span class="hljs-number">1999</span>)

<span class="hljs-comment">;Value: 1999</span>

<span class="hljs-number">1</span> ]=> (<span class="hljs-name">smallest-divisor</span> <span class="hljs-number">19999</span>)

<span class="hljs-comment">;Value: 7</span></code></pre>
<p>Well, that was unexpected. :)</p>
<h2>Exercise 1.22:</h2>
<pre><code class="hljs language-scheme">(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">prime?</span> n)
  (<span class="hljs-name"><span class="hljs-built_in">=</span></span> n (<span class="hljs-name">smallest-divisor</span> n)))
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">next-prime</span> n) 
    (<span class="hljs-name"><span class="hljs-built_in">if</span></span> (<span class="hljs-name">prime?</span> n)
        n
        (<span class="hljs-name">next-prime</span> (<span class="hljs-name"><span class="hljs-built_in">+</span></span> n <span class="hljs-number">2</span>))
    )
)
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">timed-prime-test</span> n)
    (<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">start-prime-test</span> n start-time)
      (<span class="hljs-name"><span class="hljs-built_in">display</span></span> <span class="hljs-string">"next prime after "</span>) (<span class="hljs-name"><span class="hljs-built_in">display</span></span> n)
      (<span class="hljs-name"><span class="hljs-built_in">display</span></span> <span class="hljs-string">": "</span>) (<span class="hljs-name"><span class="hljs-built_in">display</span></span> (<span class="hljs-name">next-prime</span> n)) (<span class="hljs-name"><span class="hljs-built_in">newline</span></span>)
      (<span class="hljs-name"><span class="hljs-built_in">display</span></span> <span class="hljs-string">"Time: "</span>) (<span class="hljs-name"><span class="hljs-built_in">display</span></span> (<span class="hljs-name"><span class="hljs-built_in">-</span></span> (<span class="hljs-name">runtime</span>) start-time))
      (<span class="hljs-name"><span class="hljs-built_in">newline</span></span>)
    )
    (<span class="hljs-name">start-prime-test</span> n (<span class="hljs-name">runtime</span>))
)
(<span class="hljs-name">timed-prime-test</span> <span class="hljs-number">10000000001</span>)
<span class="hljs-comment">; next prime after 10000000001: 10000000019</span>
<span class="hljs-comment">; Time: .19999999999998863</span>
(<span class="hljs-name">timed-prime-test</span> <span class="hljs-number">1000000000001</span>)
<span class="hljs-comment">; next prime after 1000000000001: 1000000000039</span>
<span class="hljs-comment">; Time: 1.3700000000000045</span></code></pre>
<p>Seems to take 10 times more time for 100 times bigger number.</p>
<h2>Exercise 1.23</h2>
<pre><code class="hljs language-scheme">(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">next</span> n) 
    (<span class="hljs-name"><span class="hljs-built_in">if</span></span> (<span class="hljs-name"><span class="hljs-built_in">=</span></span> n <span class="hljs-number">2</span>) <span class="hljs-number">3</span> (<span class="hljs-name"><span class="hljs-built_in">+</span></span> n <span class="hljs-number">2</span>))
)
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">smallest-divisor</span> n)
    (<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">find-divisor</span> n d)
        (<span class="hljs-name"><span class="hljs-built_in">cond</span></span> ((<span class="hljs-name"><span class="hljs-built_in">></span></span> (<span class="hljs-name">sqr</span> d) n) n)
            ((<span class="hljs-name">divisor?</span> d n) d)
            (<span class="hljs-name"><span class="hljs-built_in">else</span></span> (<span class="hljs-name">find-divisor</span> n (<span class="hljs-name">next</span> d)))
        )

    )
    (<span class="hljs-name">find-divisor</span> n <span class="hljs-number">2</span>)
)

(<span class="hljs-name">timed-prime-test</span> <span class="hljs-number">10000000001</span>)
<span class="hljs-comment">;Time: .12000000000000455</span>

(<span class="hljs-name">timed-prime-test</span> <span class="hljs-number">1000000000001</span>)
<span class="hljs-comment">; Time: .8000000000000114</span></code></pre>
<p>A little bit less than twice as fast. I assume this is because calling next and doing comparisons inside it takes more time than just (+ n 1)</p>
<h2>Exercise 1.24</h2>
<pre><code class="hljs language-scheme">(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">expmod</span> base exp m)
  (<span class="hljs-name"><span class="hljs-built_in">cond</span></span> ((<span class="hljs-name"><span class="hljs-built_in">=</span></span> exp <span class="hljs-number">0</span>) <span class="hljs-number">1</span>)
        ((<span class="hljs-name"><span class="hljs-built_in">even?</span></span> exp)
         (<span class="hljs-name"><span class="hljs-built_in">remainder</span></span> (<span class="hljs-name">square</span> (<span class="hljs-name">expmod</span> base (<span class="hljs-name"><span class="hljs-built_in">/</span></span> exp <span class="hljs-number">2</span>) m))
                    m))
        (<span class="hljs-name"><span class="hljs-built_in">else</span></span>
         (<span class="hljs-name"><span class="hljs-built_in">remainder</span></span> (<span class="hljs-name"><span class="hljs-built_in">*</span></span> base (<span class="hljs-name">expmod</span> base (<span class="hljs-name"><span class="hljs-built_in">-</span></span> exp <span class="hljs-number">1</span>) m))
                    m))))        
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">fermat-test</span> n)
  (<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">try-it</span> a)
    (<span class="hljs-name"><span class="hljs-built_in">=</span></span> (<span class="hljs-name">expmod</span> a n n) a))
  (<span class="hljs-name">try-it</span> (<span class="hljs-name"><span class="hljs-built_in">+</span></span> <span class="hljs-number">1</span> (<span class="hljs-name">random</span> (<span class="hljs-name"><span class="hljs-built_in">-</span></span> n <span class="hljs-number">1</span>)))))
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">fast-prime?</span> n times)
  (<span class="hljs-name"><span class="hljs-built_in">cond</span></span> ((<span class="hljs-name"><span class="hljs-built_in">=</span></span> times <span class="hljs-number">0</span>) true)
        ((<span class="hljs-name">fermat-test</span> n) (<span class="hljs-name">fast-prime?</span> n (<span class="hljs-name"><span class="hljs-built_in">-</span></span> times <span class="hljs-number">1</span>)))
        (<span class="hljs-name"><span class="hljs-built_in">else</span></span> false)))
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">next-prime</span> n) 
    (<span class="hljs-name"><span class="hljs-built_in">if</span></span> (<span class="hljs-name">fast-prime?</span> n <span class="hljs-number">10</span>)
        n
        (<span class="hljs-name">next-prime</span> (<span class="hljs-name"><span class="hljs-built_in">+</span></span> n <span class="hljs-number">2</span>))
    )
)

(<span class="hljs-name">timed-prime-test</span> <span class="hljs-number">1000000000001</span>)
<span class="hljs-comment">; next prime after 1000000000001: 1000000000039</span>
<span class="hljs-comment">; Time: 9.999999999990905e-3</span>

(<span class="hljs-name">timed-prime-test</span> <span class="hljs-number">10000000000000000000001</span>)
<span class="hljs-comment">; next prime after 10000000000000000000001: 10000000000000000000009</span>
<span class="hljs-comment">; Time: 9.999999999990905e-3</span></code></pre>
<p>Time seems to not change at all (but of course first search checked more numbers).</p>
<h2>Exercise 1.25</h2>
<p>That would slow down our computations tremendously, because we would need to multiply huge numbers. With millions of digits, which would take megabytes of memory.</p>
<h2>Exercise 1.26</h2>
<p>In correct <code>expmod</code>, every time <code>expmod</code> is recursively called with half of <code>exp</code> argument, it is called once.</p>
<p>In Louis Reasoner implementation, when <code>expmod</code> is called with halved <code>exp</code> argument, it is called twice, so halving the argument is compensated by doubling the tree of recursion, and that's why number of calls to <code>expmod</code> is proportional to the argument.</p>
<h2>Exercise 1.27</h2>
<pre><code class="hljs language-scheme">(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">full-fermat</span> n)
    (<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">f-prime?</span> a)
        (<span class="hljs-name"><span class="hljs-built_in">=</span></span> (<span class="hljs-name">expmod</span> a n n) a)
    )
    (<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">iter</span> a)
        (<span class="hljs-name"><span class="hljs-built_in">if</span></span> (<span class="hljs-name"><span class="hljs-built_in">=</span></span> a n)
            <span class="hljs-literal">#t</span> <span class="hljs-comment">; test passed</span>
            (<span class="hljs-name"><span class="hljs-built_in">if</span></span> (<span class="hljs-name">f-prime?</span> a)
                (<span class="hljs-name">iter</span> (<span class="hljs-name"><span class="hljs-built_in">+</span></span> a <span class="hljs-number">1</span>))
                <span class="hljs-literal">#f</span><span class="hljs-comment">; test failed</span>
            )
        )
    )
    (<span class="hljs-name">iter</span> <span class="hljs-number">2</span>)
)

(<span class="hljs-name">full-fermat</span> <span class="hljs-number">13</span>)<span class="hljs-comment">; #t</span>
(<span class="hljs-name">full-fermat</span> <span class="hljs-number">15</span>)<span class="hljs-comment">; #f</span>
(<span class="hljs-name">full-fermat</span> <span class="hljs-number">561</span>)<span class="hljs-comment">; #t</span>
(<span class="hljs-name">full-fermat</span> <span class="hljs-number">1105</span>)<span class="hljs-comment">; #t</span>
(<span class="hljs-name">full-fermat</span> <span class="hljs-number">1729</span>)<span class="hljs-comment">; #t</span></code></pre>
<h2>Exercise 1.28: Miller-Rabin test</h2>
<pre><code class="hljs language-scheme">(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">!=</span> a b) (<span class="hljs-name"><span class="hljs-built_in">not</span></span> (<span class="hljs-name"><span class="hljs-built_in">=</span></span> a b))) <span class="hljs-comment">; I need some Scheme reference, really. How this is not built-in?</span>

(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">report</span> n m)
  (<span class="hljs-name"><span class="hljs-built_in">display</span></span> n)
  (<span class="hljs-name"><span class="hljs-built_in">display</span></span> <span class="hljs-string">" is a nontrivial square root of 1 modulo "</span>)
  (<span class="hljs-name"><span class="hljs-built_in">display</span></span> m)
  (<span class="hljs-name"><span class="hljs-built_in">newline</span></span>)
  <span class="hljs-number">0</span>
)
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">expmod</span> base exp m)
  (<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">squaremod-signal</span> n)
    (<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">is-root?</span> sq) 
        (<span class="hljs-name"><span class="hljs-built_in">if</span></span> (<span class="hljs-name"><span class="hljs-built_in">and</span></span>  (<span class="hljs-name"><span class="hljs-built_in">=</span></span> sq <span class="hljs-number">1</span>) (<span class="hljs-name">!=</span> n <span class="hljs-number">1</span>) (<span class="hljs-name">!=</span> n (<span class="hljs-name"><span class="hljs-built_in">-</span></span> m <span class="hljs-number">1</span>)))
            (<span class="hljs-name">report</span> n m)
            sq
        )
    )
    (<span class="hljs-name">is-root?</span> (<span class="hljs-name"><span class="hljs-built_in">remainder</span></span> (<span class="hljs-name">square</span> n) m))
  )
  (<span class="hljs-name"><span class="hljs-built_in">cond</span></span> ((<span class="hljs-name"><span class="hljs-built_in">=</span></span> exp <span class="hljs-number">0</span>) <span class="hljs-number">1</span>)
        ((<span class="hljs-name"><span class="hljs-built_in">even?</span></span> exp)
         (<span class="hljs-name">squaremod-signal</span> (<span class="hljs-name">expmod</span> base (<span class="hljs-name"><span class="hljs-built_in">/</span></span> exp <span class="hljs-number">2</span>) m)))
        (<span class="hljs-name"><span class="hljs-built_in">else</span></span>
         (<span class="hljs-name"><span class="hljs-built_in">remainder</span></span> (<span class="hljs-name"><span class="hljs-built_in">*</span></span> base (<span class="hljs-name">expmod</span> base (<span class="hljs-name"><span class="hljs-built_in">-</span></span> exp <span class="hljs-number">1</span>) m))
                    m))))        
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">fast-prime?</span> n times)
  (<span class="hljs-name"><span class="hljs-built_in">cond</span></span> ((<span class="hljs-name"><span class="hljs-built_in">=</span></span> times <span class="hljs-number">0</span>) true)
        ((<span class="hljs-name">miller-rabin-test</span> n) (<span class="hljs-name">fast-prime?</span> n (<span class="hljs-name"><span class="hljs-built_in">-</span></span> times <span class="hljs-number">1</span>)))
        (<span class="hljs-name"><span class="hljs-built_in">else</span></span> false)))
(<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">miller-rabin-test</span> n)
  (<span class="hljs-name"><span class="hljs-built_in">define</span></span> (<span class="hljs-name">try-it</span> a)
    (<span class="hljs-name">!=</span> (<span class="hljs-name">expmod</span> a (<span class="hljs-name"><span class="hljs-built_in">-</span></span> n <span class="hljs-number">1</span>) n) <span class="hljs-number">0</span>)
  )
  (<span class="hljs-name"><span class="hljs-built_in">if</span></span> (<span class="hljs-name"><span class="hljs-built_in">even?</span></span> n)
      <span class="hljs-literal">#f</span>
      (<span class="hljs-name">try-it</span> (<span class="hljs-name"><span class="hljs-built_in">+</span></span> <span class="hljs-number">1</span> (<span class="hljs-name">random</span> (<span class="hljs-name"><span class="hljs-built_in">-</span></span> n <span class="hljs-number">1</span>))))
  )
)
(<span class="hljs-name">fast-prime?</span> <span class="hljs-number">1009</span> <span class="hljs-number">30</span>)
(<span class="hljs-name">fast-prime?</span> <span class="hljs-number">13</span> <span class="hljs-number">30</span>)
(<span class="hljs-name">fast-prime?</span> <span class="hljs-number">6601</span> <span class="hljs-number">30</span>)</code></pre>
<p>Whew! How this even work - no idea, but somehow it does. Thankfully I'm good in this technique:</p>
<p><img src="/content/trying-stuff-orly.jpg" alt="Trying Stuff Until it Works" title="Trying Stuff Until it Works"></p></div></article><nav><a href="/">Home</a><a href="#top">Back to top</a></nav><footer>© <!-- -->2021<!-- --> Bunyk Taras. Built with Next.js</footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"sicp1.2.6","title":"SICP 1.2.6 Primes","date":"2020-06-21","tags":["SICP"],"content":"\u003cp\u003eA little bit of number theory.\u003c/p\u003e\n\u003ch2\u003eExercise 1.21: Smallest divisors\u003c/h2\u003e\n\u003cp\u003eThis is so trivial, so I'll try to rewrite example, because it's just copypaste otherwise:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-scheme\"\u003e(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003edivisor?\u003c/span\u003e d n) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e=\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eremainder\u003c/span\u003e\u003c/span\u003e n d) \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e))\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003esmallest-divisor\u003c/span\u003e n)\n    (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003efind-divisor\u003c/span\u003e n d)\n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003econd\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003esqr\u003c/span\u003e d) n) n)\n            ((\u003cspan class=\"hljs-name\"\u003edivisor?\u003c/span\u003e d n) d)\n            (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eelse\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003efind-divisor\u003c/span\u003e n (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e+\u003c/span\u003e\u003c/span\u003e d \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)))\n        )\n\n    )\n    (\u003cspan class=\"hljs-name\"\u003efind-divisor\u003c/span\u003e n \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)\n)\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-scheme\"\u003e\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ]=\u003e (\u003cspan class=\"hljs-name\"\u003esmallest-divisor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e199\u003c/span\u003e)\n\n\u003cspan class=\"hljs-comment\"\u003e;Value: 199\u003c/span\u003e\n\n\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ]=\u003e (\u003cspan class=\"hljs-name\"\u003esmallest-divisor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1999\u003c/span\u003e)\n\n\u003cspan class=\"hljs-comment\"\u003e;Value: 1999\u003c/span\u003e\n\n\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e ]=\u003e (\u003cspan class=\"hljs-name\"\u003esmallest-divisor\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e19999\u003c/span\u003e)\n\n\u003cspan class=\"hljs-comment\"\u003e;Value: 7\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWell, that was unexpected. :)\u003c/p\u003e\n\u003ch2\u003eExercise 1.22:\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-scheme\"\u003e(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eprime?\u003c/span\u003e n)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e=\u003c/span\u003e\u003c/span\u003e n (\u003cspan class=\"hljs-name\"\u003esmallest-divisor\u003c/span\u003e n)))\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003enext-prime\u003c/span\u003e n) \n    (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eprime?\u003c/span\u003e n)\n        n\n        (\u003cspan class=\"hljs-name\"\u003enext-prime\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e+\u003c/span\u003e\u003c/span\u003e n \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e))\n    )\n)\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003etimed-prime-test\u003c/span\u003e n)\n    (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003estart-prime-test\u003c/span\u003e n start-time)\n      (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edisplay\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"next prime after \"\u003c/span\u003e) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edisplay\u003c/span\u003e\u003c/span\u003e n)\n      (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edisplay\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\": \"\u003c/span\u003e) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edisplay\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003enext-prime\u003c/span\u003e n)) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003enewline\u003c/span\u003e\u003c/span\u003e)\n      (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edisplay\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"Time: \"\u003c/span\u003e) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edisplay\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e-\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eruntime\u003c/span\u003e) start-time))\n      (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003enewline\u003c/span\u003e\u003c/span\u003e)\n    )\n    (\u003cspan class=\"hljs-name\"\u003estart-prime-test\u003c/span\u003e n (\u003cspan class=\"hljs-name\"\u003eruntime\u003c/span\u003e))\n)\n(\u003cspan class=\"hljs-name\"\u003etimed-prime-test\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e10000000001\u003c/span\u003e)\n\u003cspan class=\"hljs-comment\"\u003e; next prime after 10000000001: 10000000019\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; Time: .19999999999998863\u003c/span\u003e\n(\u003cspan class=\"hljs-name\"\u003etimed-prime-test\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1000000000001\u003c/span\u003e)\n\u003cspan class=\"hljs-comment\"\u003e; next prime after 1000000000001: 1000000000039\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; Time: 1.3700000000000045\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSeems to take 10 times more time for 100 times bigger number.\u003c/p\u003e\n\u003ch2\u003eExercise 1.23\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-scheme\"\u003e(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003enext\u003c/span\u003e n) \n    (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e=\u003c/span\u003e\u003c/span\u003e n \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e) \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e+\u003c/span\u003e\u003c/span\u003e n \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e))\n)\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003esmallest-divisor\u003c/span\u003e n)\n    (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003efind-divisor\u003c/span\u003e n d)\n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003econd\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003esqr\u003c/span\u003e d) n) n)\n            ((\u003cspan class=\"hljs-name\"\u003edivisor?\u003c/span\u003e d n) d)\n            (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eelse\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003efind-divisor\u003c/span\u003e n (\u003cspan class=\"hljs-name\"\u003enext\u003c/span\u003e d)))\n        )\n\n    )\n    (\u003cspan class=\"hljs-name\"\u003efind-divisor\u003c/span\u003e n \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)\n)\n\n(\u003cspan class=\"hljs-name\"\u003etimed-prime-test\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e10000000001\u003c/span\u003e)\n\u003cspan class=\"hljs-comment\"\u003e;Time: .12000000000000455\u003c/span\u003e\n\n(\u003cspan class=\"hljs-name\"\u003etimed-prime-test\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1000000000001\u003c/span\u003e)\n\u003cspan class=\"hljs-comment\"\u003e; Time: .8000000000000114\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eA little bit less than twice as fast. I assume this is because calling next and doing comparisons inside it takes more time than just (+ n 1)\u003c/p\u003e\n\u003ch2\u003eExercise 1.24\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-scheme\"\u003e(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eexpmod\u003c/span\u003e base exp m)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003econd\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e=\u003c/span\u003e\u003c/span\u003e exp \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n        ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eeven?\u003c/span\u003e\u003c/span\u003e exp)\n         (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eremainder\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003esquare\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eexpmod\u003c/span\u003e base (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e/\u003c/span\u003e\u003c/span\u003e exp \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e) m))\n                    m))\n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eelse\u003c/span\u003e\u003c/span\u003e\n         (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eremainder\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e*\u003c/span\u003e\u003c/span\u003e base (\u003cspan class=\"hljs-name\"\u003eexpmod\u003c/span\u003e base (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e-\u003c/span\u003e\u003c/span\u003e exp \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) m))\n                    m))))        \n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003efermat-test\u003c/span\u003e n)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003etry-it\u003c/span\u003e a)\n    (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e=\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eexpmod\u003c/span\u003e a n n) a))\n  (\u003cspan class=\"hljs-name\"\u003etry-it\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e+\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003erandom\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e-\u003c/span\u003e\u003c/span\u003e n \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)))))\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003efast-prime?\u003c/span\u003e n times)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003econd\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e=\u003c/span\u003e\u003c/span\u003e times \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) true)\n        ((\u003cspan class=\"hljs-name\"\u003efermat-test\u003c/span\u003e n) (\u003cspan class=\"hljs-name\"\u003efast-prime?\u003c/span\u003e n (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e-\u003c/span\u003e\u003c/span\u003e times \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)))\n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eelse\u003c/span\u003e\u003c/span\u003e false)))\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003enext-prime\u003c/span\u003e n) \n    (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003efast-prime?\u003c/span\u003e n \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e)\n        n\n        (\u003cspan class=\"hljs-name\"\u003enext-prime\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e+\u003c/span\u003e\u003c/span\u003e n \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e))\n    )\n)\n\n(\u003cspan class=\"hljs-name\"\u003etimed-prime-test\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1000000000001\u003c/span\u003e)\n\u003cspan class=\"hljs-comment\"\u003e; next prime after 1000000000001: 1000000000039\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; Time: 9.999999999990905e-3\u003c/span\u003e\n\n(\u003cspan class=\"hljs-name\"\u003etimed-prime-test\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e10000000000000000000001\u003c/span\u003e)\n\u003cspan class=\"hljs-comment\"\u003e; next prime after 10000000000000000000001: 10000000000000000000009\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; Time: 9.999999999990905e-3\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eTime seems to not change at all (but of course first search checked more numbers).\u003c/p\u003e\n\u003ch2\u003eExercise 1.25\u003c/h2\u003e\n\u003cp\u003eThat would slow down our computations tremendously, because we would need to multiply huge numbers. With millions of digits, which would take megabytes of memory.\u003c/p\u003e\n\u003ch2\u003eExercise 1.26\u003c/h2\u003e\n\u003cp\u003eIn correct \u003ccode\u003eexpmod\u003c/code\u003e, every time \u003ccode\u003eexpmod\u003c/code\u003e is recursively called with half of \u003ccode\u003eexp\u003c/code\u003e argument, it is called once.\u003c/p\u003e\n\u003cp\u003eIn Louis Reasoner implementation, when \u003ccode\u003eexpmod\u003c/code\u003e is called with halved \u003ccode\u003eexp\u003c/code\u003e argument, it is called twice, so halving the argument is compensated by doubling the tree of recursion, and that's why number of calls to \u003ccode\u003eexpmod\u003c/code\u003e is proportional to the argument.\u003c/p\u003e\n\u003ch2\u003eExercise 1.27\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-scheme\"\u003e(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003efull-fermat\u003c/span\u003e n)\n    (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ef-prime?\u003c/span\u003e a)\n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e=\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eexpmod\u003c/span\u003e a n n) a)\n    )\n    (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eiter\u003c/span\u003e a)\n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e=\u003c/span\u003e\u003c/span\u003e a n)\n            \u003cspan class=\"hljs-literal\"\u003e#t\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; test passed\u003c/span\u003e\n            (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ef-prime?\u003c/span\u003e a)\n                (\u003cspan class=\"hljs-name\"\u003eiter\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e+\u003c/span\u003e\u003c/span\u003e a \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e))\n                \u003cspan class=\"hljs-literal\"\u003e#f\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e; test failed\u003c/span\u003e\n            )\n        )\n    )\n    (\u003cspan class=\"hljs-name\"\u003eiter\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)\n)\n\n(\u003cspan class=\"hljs-name\"\u003efull-fermat\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e)\u003cspan class=\"hljs-comment\"\u003e; #t\u003c/span\u003e\n(\u003cspan class=\"hljs-name\"\u003efull-fermat\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e)\u003cspan class=\"hljs-comment\"\u003e; #f\u003c/span\u003e\n(\u003cspan class=\"hljs-name\"\u003efull-fermat\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e561\u003c/span\u003e)\u003cspan class=\"hljs-comment\"\u003e; #t\u003c/span\u003e\n(\u003cspan class=\"hljs-name\"\u003efull-fermat\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1105\u003c/span\u003e)\u003cspan class=\"hljs-comment\"\u003e; #t\u003c/span\u003e\n(\u003cspan class=\"hljs-name\"\u003efull-fermat\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1729\u003c/span\u003e)\u003cspan class=\"hljs-comment\"\u003e; #t\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eExercise 1.28: Miller-Rabin test\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-scheme\"\u003e(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e!=\u003c/span\u003e a b) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003enot\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e=\u003c/span\u003e\u003c/span\u003e a b))) \u003cspan class=\"hljs-comment\"\u003e; I need some Scheme reference, really. How this is not built-in?\u003c/span\u003e\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ereport\u003c/span\u003e n m)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edisplay\u003c/span\u003e\u003c/span\u003e n)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edisplay\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\" is a nontrivial square root of 1 modulo \"\u003c/span\u003e)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edisplay\u003c/span\u003e\u003c/span\u003e m)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003enewline\u003c/span\u003e\u003c/span\u003e)\n  \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n)\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eexpmod\u003c/span\u003e base exp m)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003esquaremod-signal\u003c/span\u003e n)\n    (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eis-root?\u003c/span\u003e sq) \n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eand\u003c/span\u003e\u003c/span\u003e  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e=\u003c/span\u003e\u003c/span\u003e sq \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) (\u003cspan class=\"hljs-name\"\u003e!=\u003c/span\u003e n \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) (\u003cspan class=\"hljs-name\"\u003e!=\u003c/span\u003e n (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e-\u003c/span\u003e\u003c/span\u003e m \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)))\n            (\u003cspan class=\"hljs-name\"\u003ereport\u003c/span\u003e n m)\n            sq\n        )\n    )\n    (\u003cspan class=\"hljs-name\"\u003eis-root?\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eremainder\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003esquare\u003c/span\u003e n) m))\n  )\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003econd\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e=\u003c/span\u003e\u003c/span\u003e exp \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n        ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eeven?\u003c/span\u003e\u003c/span\u003e exp)\n         (\u003cspan class=\"hljs-name\"\u003esquaremod-signal\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eexpmod\u003c/span\u003e base (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e/\u003c/span\u003e\u003c/span\u003e exp \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e) m)))\n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eelse\u003c/span\u003e\u003c/span\u003e\n         (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eremainder\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e*\u003c/span\u003e\u003c/span\u003e base (\u003cspan class=\"hljs-name\"\u003eexpmod\u003c/span\u003e base (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e-\u003c/span\u003e\u003c/span\u003e exp \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) m))\n                    m))))        \n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003efast-prime?\u003c/span\u003e n times)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003econd\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e=\u003c/span\u003e\u003c/span\u003e times \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) true)\n        ((\u003cspan class=\"hljs-name\"\u003emiller-rabin-test\u003c/span\u003e n) (\u003cspan class=\"hljs-name\"\u003efast-prime?\u003c/span\u003e n (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e-\u003c/span\u003e\u003c/span\u003e times \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)))\n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eelse\u003c/span\u003e\u003c/span\u003e false)))\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emiller-rabin-test\u003c/span\u003e n)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003etry-it\u003c/span\u003e a)\n    (\u003cspan class=\"hljs-name\"\u003e!=\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eexpmod\u003c/span\u003e a (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e-\u003c/span\u003e\u003c/span\u003e n \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) n) \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n  )\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003eeven?\u003c/span\u003e\u003c/span\u003e n)\n      \u003cspan class=\"hljs-literal\"\u003e#f\u003c/span\u003e\n      (\u003cspan class=\"hljs-name\"\u003etry-it\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e+\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003erandom\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-built_in\"\u003e-\u003c/span\u003e\u003c/span\u003e n \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e))))\n  )\n)\n(\u003cspan class=\"hljs-name\"\u003efast-prime?\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1009\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e)\n(\u003cspan class=\"hljs-name\"\u003efast-prime?\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e)\n(\u003cspan class=\"hljs-name\"\u003efast-prime?\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e6601\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e)\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWhew! How this even work - no idea, but somehow it does. Thankfully I'm good in this technique:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/content/trying-stuff-orly.jpg\" alt=\"Trying Stuff Until it Works\" title=\"Trying Stuff Until it Works\"\u003e\u003c/p\u003e"},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"sicp1.2.6"},"buildId":"BV4uJJEMRM41pRC-d7IhI","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>