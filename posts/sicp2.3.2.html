<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>SICP 2.3.2 Symbolic differentiation</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/f969c0c492dd18a0081f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f969c0c492dd18a0081f.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-fb76148cfcfb42ca18eb.js" defer=""></script><script src="/_next/static/chunks/framework-2191d16384373197bc0a.js" defer=""></script><script src="/_next/static/chunks/main-89e612c37cd79392e22d.js" defer=""></script><script src="/_next/static/chunks/pages/_app-459ac92bde4bcd5c6050.js" defer=""></script><script src="/_next/static/chunks/762-0f685813c4b6ace6d024.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-338567653ad135dab1d7.js" defer=""></script><script src="/_next/static/sMnLAto4YhgRliyLu0bmY/_buildManifest.js" defer=""></script><script src="/_next/static/sMnLAto4YhgRliyLu0bmY/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="MuiContainer-root MuiContainer-maxWidthMd"><div class="MuiToolbar-root MuiToolbar-regular jss1 MuiToolbar-gutters"><h1 class="MuiTypography-root jss2 MuiTypography-h5 MuiTypography-noWrap" aligh="center">Taras Bunyk</h1></div><nav class="MuiToolbar-root MuiToolbar-dense jss3 MuiToolbar-gutters"><a href="/">Home</a><a href="http://bunyk.github.io/mandala/">Snowflake drawing</a><a href="/resume">Resume</a><a href="https://bunyk.wordpress.com/">Old blog (in Ukrainian)</a></nav><div class="MuiGrid-root MuiGrid-container MuiGrid-spacing-xs-5"><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12 MuiGrid-grid-md-9"><div class="MuiPaper-root MuiCard-root MuiPaper-elevation1 MuiPaper-rounded"><div class="MuiCardHeader-root"><div class="MuiCardHeader-content"><span class="MuiTypography-root MuiCardHeader-title MuiTypography-h5 MuiTypography-displayBlock">SICP 2.3.2 Symbolic differentiation</span><span class="MuiTypography-root MuiCardHeader-subheader MuiTypography-body1 MuiTypography-colorTextSecondary MuiTypography-displayBlock">Published: 2020-07-26 Tags: SICP</span></div></div><div class="MuiCardContent-root"><p>I decided to skip picture language, because of technical reasons. Also, 2.3.1 I'll do in this post, because it was just to short. Here we get one step clother to build interpreter, not yet for programming language, but at least for mathematical expressions.</p>
<p>And now we are in the <a href="https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-16.html#%25_sec_2.3">middle of second chapter</a>.</p>
<h2>Exercise 2.54</h2>
<pre><code class="hljs language-scheme">(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">equal?</span></span> l1 l2)
  (<span class="hljs-name"><span class="hljs-builtin-name">if</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">pair?</span></span> l1)
    (<span class="hljs-name"><span class="hljs-builtin-name">if</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">pair?</span></span> l2)
      (<span class="hljs-name"><span class="hljs-builtin-name">if</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">equal?</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">car</span></span> l1) (<span class="hljs-name"><span class="hljs-builtin-name">car</span></span> l2))
        (<span class="hljs-name"><span class="hljs-builtin-name">equal?</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">cdr</span></span> l1) (<span class="hljs-name"><span class="hljs-builtin-name">cdr</span></span> l2))
        <span class="hljs-literal">#f</span>
      )
      <span class="hljs-literal">#f</span>
    )
    (<span class="hljs-name"><span class="hljs-builtin-name">if</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">pair?</span></span> l2)
      <span class="hljs-literal">#f</span>
      (<span class="hljs-name"><span class="hljs-builtin-name">eq?</span></span> l1 l2) 
    )
  )
)
(<span class="hljs-name"><span class="hljs-builtin-name">equal?</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">list</span></span> <span class="hljs-number">1</span> <span class="hljs-number">2</span>) '(<span class="hljs-number">1</span> <span class="hljs-number">2</span>))
(<span class="hljs-name"><span class="hljs-builtin-name">equal?</span></span> '() '())
(<span class="hljs-name"><span class="hljs-builtin-name">equal?</span></span> <span class="hljs-symbol">'a</span> <span class="hljs-symbol">'a</span>)
(<span class="hljs-name"><span class="hljs-builtin-name">equal?</span></span> <span class="hljs-symbol">'a</span> <span class="hljs-symbol">'b</span>)
(<span class="hljs-name"><span class="hljs-builtin-name">equal?</span></span> '(<span class="hljs-number">1</span> <span class="hljs-number">2</span>) '(list <span class="hljs-number">1</span> <span class="hljs-number">2</span>))</code></pre>
<h2>Exercise 2.55</h2>
<p><code>''abracadabra</code> is actually a <code>(quote (quote abracadabra))</code> which has value <code>(quote abracadabra)</code>, and <code>car</code> of it is <code>quote</code>.</p>
<h2>Exercise 2.56</h2>
<pre><code class="hljs language-scheme">(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">variable?</span> x) (<span class="hljs-name"><span class="hljs-builtin-name">symbol?</span></span> x))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">same-variable?</span> v1 v2)
  (<span class="hljs-name"><span class="hljs-builtin-name">and</span></span> (<span class="hljs-name">variable?</span> v1) (<span class="hljs-name">variable?</span> v2) (<span class="hljs-name"><span class="hljs-builtin-name">eq?</span></span> v1 v2)))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">=number?</span> exp num)
  (<span class="hljs-name"><span class="hljs-builtin-name">and</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">number?</span></span> exp) (<span class="hljs-name"><span class="hljs-builtin-name">=</span></span> exp num)))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">make-sum</span> a1 a2)
  (<span class="hljs-name"><span class="hljs-builtin-name">cond</span></span> ((<span class="hljs-name">=number?</span> a1 <span class="hljs-number">0</span>) a2)
        ((<span class="hljs-name">=number?</span> a2 <span class="hljs-number">0</span>) a1)
        ((<span class="hljs-name"><span class="hljs-builtin-name">and</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">number?</span></span> a1) (<span class="hljs-name"><span class="hljs-builtin-name">number?</span></span> a2)) (<span class="hljs-name"><span class="hljs-builtin-name">+</span></span> a1 a2))
        (<span class="hljs-name"><span class="hljs-builtin-name">else</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">list</span></span> <span class="hljs-symbol">'+</span> a1 a2))))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">make-product</span> m1 m2)
  (<span class="hljs-name"><span class="hljs-builtin-name">cond</span></span> ((<span class="hljs-name"><span class="hljs-builtin-name">or</span></span> (<span class="hljs-name">=number?</span> m1 <span class="hljs-number">0</span>) (<span class="hljs-name">=number?</span> m2 <span class="hljs-number">0</span>)) <span class="hljs-number">0</span>)
        ((<span class="hljs-name">=number?</span> m1 <span class="hljs-number">1</span>) m2)
        ((<span class="hljs-name">=number?</span> m2 <span class="hljs-number">1</span>) m1)
        ((<span class="hljs-name"><span class="hljs-builtin-name">and</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">number?</span></span> m1) (<span class="hljs-name"><span class="hljs-builtin-name">number?</span></span> m2)) (<span class="hljs-name"><span class="hljs-builtin-name">*</span></span> m1 m2))
        (<span class="hljs-name"><span class="hljs-builtin-name">else</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">list</span></span> <span class="hljs-symbol">'*</span> m1 m2))))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">sum?</span> x)
  (<span class="hljs-name"><span class="hljs-builtin-name">and</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">pair?</span></span> x) (<span class="hljs-name"><span class="hljs-builtin-name">eq?</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">car</span></span> x) <span class="hljs-symbol">'+</span>)))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">addend</span> s) (<span class="hljs-name"><span class="hljs-builtin-name">cadr</span></span> s))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">augend</span> s) (<span class="hljs-name">caddr</span> s))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">product?</span> x)
  (<span class="hljs-name"><span class="hljs-builtin-name">and</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">pair?</span></span> x) (<span class="hljs-name"><span class="hljs-builtin-name">eq?</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">car</span></span> x) <span class="hljs-symbol">'*</span>)))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">multiplier</span> p) (<span class="hljs-name"><span class="hljs-builtin-name">cadr</span></span> p))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">multiplicand</span> p) (<span class="hljs-name">caddr</span> p))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">exponentiation?</span> x)
  (<span class="hljs-name"><span class="hljs-builtin-name">and</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">pair?</span></span> x) (<span class="hljs-name"><span class="hljs-builtin-name">eq?</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">car</span></span> x) <span class="hljs-symbol">'**</span>)))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">base</span> e) (<span class="hljs-name"><span class="hljs-builtin-name">cadr</span></span> e))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">exponent</span> e) (<span class="hljs-name">caddr</span> e))
 
(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">make-exponentiation</span> base e)
  (<span class="hljs-name"><span class="hljs-builtin-name">cond</span></span> ((<span class="hljs-name">=number?</span> e <span class="hljs-number">0</span>) <span class="hljs-number">1</span>)
        ((<span class="hljs-name">=number?</span> e <span class="hljs-number">1</span>) base)
        (<span class="hljs-name"><span class="hljs-builtin-name">else</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">list</span></span> <span class="hljs-symbol">'**</span> base e))))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">deriv</span> exp var)
  (<span class="hljs-name"><span class="hljs-builtin-name">cond</span></span> ((<span class="hljs-name"><span class="hljs-builtin-name">number?</span></span> exp) <span class="hljs-number">0</span>)
        ((<span class="hljs-name">variable?</span> exp)
         (<span class="hljs-name"><span class="hljs-builtin-name">if</span></span> (<span class="hljs-name">same-variable?</span> exp var) <span class="hljs-number">1</span> <span class="hljs-number">0</span>))
        ((<span class="hljs-name">sum?</span> exp)
         (<span class="hljs-name">make-sum</span> (<span class="hljs-name">deriv</span> (<span class="hljs-name">addend</span> exp) var)
                   (<span class="hljs-name">deriv</span> (<span class="hljs-name">augend</span> exp) var)))
        ((<span class="hljs-name">product?</span> exp)
         (<span class="hljs-name">make-sum</span>
           (<span class="hljs-name">make-product</span> (<span class="hljs-name">multiplier</span> exp)
                         (<span class="hljs-name">deriv</span> (<span class="hljs-name">multiplicand</span> exp) var))
           (<span class="hljs-name">make-product</span> (<span class="hljs-name">deriv</span> (<span class="hljs-name">multiplier</span> exp) var)
                         (<span class="hljs-name">multiplicand</span> exp))))
        ((<span class="hljs-name">exponentiation?</span> exp)
         (<span class="hljs-name">make-product</span> (<span class="hljs-name">exponent</span> exp) (<span class="hljs-name">make-exponentiation</span> 
                (<span class="hljs-name">base</span> exp)
                (<span class="hljs-name"><span class="hljs-builtin-name">-</span></span> (<span class="hljs-name">exponent</span> exp) <span class="hljs-number">1</span>)
            )))
        (<span class="hljs-name"><span class="hljs-builtin-name">else</span></span>
         (<span class="hljs-name">error</span> <span class="hljs-string">"unknown expression type -- DERIV"</span> exp))))


(<span class="hljs-name">deriv</span> '(+ (** x <span class="hljs-number">3</span>) (** x <span class="hljs-number">2</span>)) <span class="hljs-symbol">'x</span>)</code></pre>
<h2>Exercise 2.57</h2>
<pre><code class="hljs language-scheme">(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">make-sum</span> a1 a2)
  (<span class="hljs-name"><span class="hljs-builtin-name">cond</span></span> ((<span class="hljs-name">=number?</span> a1 <span class="hljs-number">0</span>) a2)
        ((<span class="hljs-name">=number?</span> a2 <span class="hljs-number">0</span>) a1)
        ((<span class="hljs-name"><span class="hljs-builtin-name">and</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">number?</span></span> a1) (<span class="hljs-name"><span class="hljs-builtin-name">number?</span></span> a2)) (<span class="hljs-name"><span class="hljs-builtin-name">+</span></span> a1 a2))
        ((<span class="hljs-name">sum?</span> a2) (<span class="hljs-name"><span class="hljs-builtin-name">append</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">list</span></span> <span class="hljs-symbol">'+</span> a1) (<span class="hljs-name"><span class="hljs-builtin-name">cdr</span></span> a2)))
        (<span class="hljs-name"><span class="hljs-builtin-name">else</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">list</span></span> <span class="hljs-symbol">'+</span> a1 a2))))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">addend</span> s) (<span class="hljs-name"><span class="hljs-builtin-name">cadr</span></span> s))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">augend</span> s) 
  (<span class="hljs-name"><span class="hljs-builtin-name">if</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">null?</span></span> (<span class="hljs-name">cdddr</span> s))
    (<span class="hljs-name">caddr</span> s)
    (<span class="hljs-name"><span class="hljs-builtin-name">cons</span></span> <span class="hljs-symbol">'+</span> (<span class="hljs-name">cddr</span> s))))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">make-product</span> m1 m2)
  (<span class="hljs-name"><span class="hljs-builtin-name">cond</span></span> ((<span class="hljs-name"><span class="hljs-builtin-name">or</span></span> (<span class="hljs-name">=number?</span> m1 <span class="hljs-number">0</span>) (<span class="hljs-name">=number?</span> m2 <span class="hljs-number">0</span>)) <span class="hljs-number">0</span>)
        ((<span class="hljs-name">=number?</span> m1 <span class="hljs-number">1</span>) m2)
        ((<span class="hljs-name">=number?</span> m2 <span class="hljs-number">1</span>) m1)
        ((<span class="hljs-name"><span class="hljs-builtin-name">and</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">number?</span></span> m1) (<span class="hljs-name"><span class="hljs-builtin-name">number?</span></span> m2)) (<span class="hljs-name"><span class="hljs-builtin-name">*</span></span> m1 m2))
        ((<span class="hljs-name">product?</span> m2) (<span class="hljs-name"><span class="hljs-builtin-name">append</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">list</span></span> <span class="hljs-symbol">'*</span> m1) (<span class="hljs-name"><span class="hljs-builtin-name">cdr</span></span> m2)))
        (<span class="hljs-name"><span class="hljs-builtin-name">else</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">list</span></span> <span class="hljs-symbol">'*</span> m1 m2))))


(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">multiplier</span> p) (<span class="hljs-name"><span class="hljs-builtin-name">cadr</span></span> p))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">multiplicand</span> s) 
  (<span class="hljs-name"><span class="hljs-builtin-name">if</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">null?</span></span> (<span class="hljs-name">cdddr</span> s))
    (<span class="hljs-name">caddr</span> s)
    (<span class="hljs-name"><span class="hljs-builtin-name">cons</span></span> <span class="hljs-symbol">'*</span> (<span class="hljs-name">cddr</span> s))))

(<span class="hljs-name">deriv</span> '(+ x (* x x x) (** x <span class="hljs-number">3</span>)) <span class="hljs-symbol">'x</span>)
<span class="hljs-comment">;Value 30: (+ 1 (+ (* x (+ x x)) (* x x)) (* 3 (** x 2)))</span></code></pre>
<h2>Exercise 2.58</h2>
<p>So, we want this to work:</p>
<pre><code class="hljs language-scheme">(<span class="hljs-name">deriv</span> '(x + x**2 + <span class="hljs-number">3</span> * x**3) <span class="hljs-symbol">'x</span>)</code></pre>
<p>At first I wanted to add some parsing step that converts this to lisp, and then reread requirements, and found this: "Can you design appropriate predicates, selectors, and constructors for this notation such that our derivative program still works?"</p>
<p>So, no transformation, this should be the format of data, and we need to change functions that work with it.</p>
<pre><code class="hljs language-scheme">(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">priority</span> sym)
  (<span class="hljs-name"><span class="hljs-builtin-name">cond</span></span> 
    ((<span class="hljs-name"><span class="hljs-builtin-name">eq?</span></span> sym <span class="hljs-symbol">'+</span>) <span class="hljs-number">1</span>)
    ((<span class="hljs-name"><span class="hljs-builtin-name">eq?</span></span> sym <span class="hljs-symbol">'*</span>) <span class="hljs-number">2</span>)
    ((<span class="hljs-name"><span class="hljs-builtin-name">eq?</span></span> sym <span class="hljs-symbol">'**</span>) <span class="hljs-number">3</span>)
    ((<span class="hljs-name"><span class="hljs-builtin-name">number?</span></span> sym) <span class="hljs-number">4</span>)
    ((<span class="hljs-name">variable?</span> sym) <span class="hljs-number">4</span>)
    ((<span class="hljs-name"><span class="hljs-builtin-name">pair?</span></span> sym) <span class="hljs-number">4</span>)
    (<span class="hljs-name"><span class="hljs-builtin-name">else</span></span> (<span class="hljs-name">error</span> <span class="hljs-string">"unknown symbol --priority"</span> sym))
  )
)

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">least-priority-operation</span> exp)
    (<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">iter</span> op min-pr exp)
        (<span class="hljs-name"><span class="hljs-builtin-name">if</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">null?</span></span> exp)
            op
            (<span class="hljs-name"><span class="hljs-builtin-name">let</span></span> ((<span class="hljs-name">np</span> (<span class="hljs-name">priority</span> (<span class="hljs-name"><span class="hljs-builtin-name">car</span></span> exp))))
                (<span class="hljs-name"><span class="hljs-builtin-name">if</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">&#x3C;</span></span> np min-pr)
                    (<span class="hljs-name">iter</span> (<span class="hljs-name"><span class="hljs-builtin-name">car</span></span> exp) np (<span class="hljs-name"><span class="hljs-builtin-name">cdr</span></span> exp))
                    (<span class="hljs-name">iter</span> op min-pr (<span class="hljs-name"><span class="hljs-builtin-name">cdr</span></span> exp))
                )
            )
        )
    )
    (<span class="hljs-name">iter</span> (<span class="hljs-name"><span class="hljs-builtin-name">car</span></span> exp) (<span class="hljs-name">priority</span> (<span class="hljs-name"><span class="hljs-builtin-name">car</span></span> exp)) (<span class="hljs-name"><span class="hljs-builtin-name">cdr</span></span> exp))
)

(<span class="hljs-name">least-priority-operation</span> '(x + x**2 + <span class="hljs-number">3</span> * x**3))
(<span class="hljs-name">least-priority-operation</span> '(x * y ** <span class="hljs-number">2</span>))
(<span class="hljs-name">least-priority-operation</span> '(y ** <span class="hljs-number">2</span>))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">unwrap</span> val) 
    (<span class="hljs-name"><span class="hljs-builtin-name">if</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">and</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">pair?</span></span> val) (<span class="hljs-name"><span class="hljs-builtin-name">null?</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">cdr</span></span> val)))
        (<span class="hljs-name"><span class="hljs-builtin-name">car</span></span> val)
        val
    )
)

<span class="hljs-comment">; Return part of expression before first appearance of given symbol</span>
(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">before</span> sym exp)
    (<span class="hljs-name"><span class="hljs-builtin-name">if</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">or</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">null?</span></span> exp) (<span class="hljs-name"><span class="hljs-builtin-name">eq?</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">car</span></span> exp) sym))
        '()
        (<span class="hljs-name"><span class="hljs-builtin-name">cons</span></span>
            (<span class="hljs-name"><span class="hljs-builtin-name">car</span></span> exp)
            (<span class="hljs-name">before</span> sym (<span class="hljs-name"><span class="hljs-builtin-name">cdr</span></span> exp))
        )
    )
)

(<span class="hljs-name">before</span> <span class="hljs-symbol">'+</span> '(y ** <span class="hljs-number">2</span> + <span class="hljs-number">3</span>))

<span class="hljs-comment">; Return part of expression after symbol</span>
<span class="hljs-comment">; BTW, for division to work properly we need to take last occurence here, but </span>
<span class="hljs-comment">; as we don't have division - I'll leave it with first</span>
(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">after</span> sym exp)
    (<span class="hljs-name"><span class="hljs-builtin-name">if</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">null?</span></span> exp)
        '()
        (<span class="hljs-name"><span class="hljs-builtin-name">if</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">eq?</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">car</span></span> exp) sym)
            (<span class="hljs-name">unwrap</span> (<span class="hljs-name"><span class="hljs-builtin-name">cdr</span></span> exp))
            (<span class="hljs-name">after</span> sym (<span class="hljs-name"><span class="hljs-builtin-name">cdr</span></span> exp))
        )
    )
)

(<span class="hljs-name">after</span> <span class="hljs-symbol">'+</span> '(y ** <span class="hljs-number">2</span> + <span class="hljs-number">3</span>))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">make-sum</span> a1 a2)
  (<span class="hljs-name"><span class="hljs-builtin-name">cond</span></span> ((<span class="hljs-name">=number?</span> a1 <span class="hljs-number">0</span>) a2)
        ((<span class="hljs-name">=number?</span> a2 <span class="hljs-number">0</span>) a1)
        ((<span class="hljs-name"><span class="hljs-builtin-name">and</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">number?</span></span> a1) (<span class="hljs-name"><span class="hljs-builtin-name">number?</span></span> a2)) (<span class="hljs-name"><span class="hljs-builtin-name">+</span></span> a1 a2))
        (<span class="hljs-name"><span class="hljs-builtin-name">else</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">list</span></span> a1 <span class="hljs-symbol">'+</span> a2))))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">make-product</span> m1 m2)
  (<span class="hljs-name"><span class="hljs-builtin-name">cond</span></span> ((<span class="hljs-name"><span class="hljs-builtin-name">or</span></span> (<span class="hljs-name">=number?</span> m1 <span class="hljs-number">0</span>) (<span class="hljs-name">=number?</span> m2 <span class="hljs-number">0</span>)) <span class="hljs-number">0</span>)
        ((<span class="hljs-name">=number?</span> m1 <span class="hljs-number">1</span>) m2)
        ((<span class="hljs-name">=number?</span> m2 <span class="hljs-number">1</span>) m1)
        ((<span class="hljs-name"><span class="hljs-builtin-name">and</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">number?</span></span> m1) (<span class="hljs-name"><span class="hljs-builtin-name">number?</span></span> m2)) (<span class="hljs-name"><span class="hljs-builtin-name">*</span></span> m1 m2))
        (<span class="hljs-name"><span class="hljs-builtin-name">else</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">list</span></span> m1 <span class="hljs-symbol">'*</span> m2))))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">sum?</span> x)
  (<span class="hljs-name"><span class="hljs-builtin-name">and</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">pair?</span></span> x) (<span class="hljs-name"><span class="hljs-builtin-name">eq?</span></span> (<span class="hljs-name">least-priority-operation</span> x) <span class="hljs-symbol">'+</span>)))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">addend</span> s) (<span class="hljs-name">unwrap</span> (<span class="hljs-name">before</span> <span class="hljs-symbol">'+</span> s)))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">augend</span> s) (<span class="hljs-name">after</span> <span class="hljs-symbol">'+</span> s))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">product?</span> x)
  (<span class="hljs-name"><span class="hljs-builtin-name">and</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">pair?</span></span> x) (<span class="hljs-name"><span class="hljs-builtin-name">eq?</span></span> (<span class="hljs-name">least-priority-operation</span> x) <span class="hljs-symbol">'*</span>)))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">multiplier</span> p) (<span class="hljs-name">unwrap</span> (<span class="hljs-name">before</span> <span class="hljs-symbol">'*</span> p)))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">multiplicand</span> p) (<span class="hljs-name">after</span> <span class="hljs-symbol">'*</span> p))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">exponentiation?</span> x)
  (<span class="hljs-name"><span class="hljs-builtin-name">and</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">pair?</span></span> x) (<span class="hljs-name"><span class="hljs-builtin-name">eq?</span></span> (<span class="hljs-name">least-priority-operation</span> x) <span class="hljs-symbol">'**</span>)))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">base</span> e) (<span class="hljs-name">unwrap</span> (<span class="hljs-name">before</span> <span class="hljs-symbol">'**</span> e)))

(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">exponent</span> e) (<span class="hljs-name">after</span> <span class="hljs-symbol">'**</span> e))
 
(<span class="hljs-name"><span class="hljs-builtin-name">define</span></span> (<span class="hljs-name">make-exponentiation</span> base e)
  (<span class="hljs-name"><span class="hljs-builtin-name">cond</span></span> ((<span class="hljs-name">=number?</span> e <span class="hljs-number">0</span>) <span class="hljs-number">1</span>)
        ((<span class="hljs-name">=number?</span> e <span class="hljs-number">1</span>) base)
        (<span class="hljs-name"><span class="hljs-builtin-name">else</span></span> (<span class="hljs-name"><span class="hljs-builtin-name">list</span></span> base <span class="hljs-symbol">'**</span> e))))

(<span class="hljs-name">deriv</span> '(x + x ** <span class="hljs-number">2</span> + <span class="hljs-number">3</span> * x ** <span class="hljs-number">3</span>) <span class="hljs-symbol">'x</span>)</code></pre>
<p>This is rather ugly (I don't like <code>before</code>, <code>after</code>, <code>unwrap</code> etc., it does not seem very performant to use them), but I see we will have another example Symbolic Algebra later, maybe there will be a chance to make it better.</p></div></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12 MuiGrid-grid-md-3"><h6 class="MuiTypography-root jss5 MuiTypography-h6 MuiTypography-gutterBottom">Archives</h6><ul><li><a href="/month/2021-01/page/1">2021-01</a> <span title="posts count">(<!-- -->4<!-- -->)</span></li><li><a href="/month/2020-12/page/1">2020-12</a> <span title="posts count">(<!-- -->1<!-- -->)</span></li><li><a href="/month/2020-09/page/1">2020-09</a> <span title="posts count">(<!-- -->2<!-- -->)</span></li><li><a href="/month/2020-08/page/1">2020-08</a> <span title="posts count">(<!-- -->2<!-- -->)</span></li><li><a href="/month/2020-07/page/1">2020-07</a> <span title="posts count">(<!-- -->10<!-- -->)</span></li><li><a href="/month/2020-06/page/1">2020-06</a> <span title="posts count">(<!-- -->7<!-- -->)</span></li><li><a href="/month/2018-12/page/1">2018-12</a> <span title="posts count">(<!-- -->1<!-- -->)</span></li></ul><h6 class="MuiTypography-root jss5 MuiTypography-h6 MuiTypography-gutterBottom">Topics</h6><ul><li><a href="/tag/MOOC/page/1">MOOC</a> <span title="posts count">(<!-- -->2<!-- -->)</span></li><li><a href="/tag/SICP/page/1">SICP</a> <span title="posts count">(<!-- -->20<!-- -->)</span></li><li><a href="/tag/ideas/page/1">ideas</a> <span title="posts count">(<!-- -->1<!-- -->)</span></li><li><a href="/tag/notes/page/1">notes</a> <span title="posts count">(<!-- -->5<!-- -->)</span></li><li><a href="/tag/on%20writing/page/1">on writing</a> <span title="posts count">(<!-- -->3<!-- -->)</span></li></ul></div><p class="MuiTypography-root MuiTypography-body2 MuiTypography-colorTextSecondary MuiTypography-alignCenter">© <!-- -->2021<!-- --> Bunyk Taras. Built with Material UI &amp; Next.js</p></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"id":"sicp2.3.2","title":"SICP 2.3.2 Symbolic differentiation","date":"2020-07-26","tags":["SICP"],"excerpt":"\u003cp\u003eI decided to skip picture language, because of technical reasons. Also, 2.3.1 I'll do in this post, because it was just to short. Here we get one step clother to build interpreter, not yet for programming language, but at least for mathematical expressions.\u003c/p\u003e\n\u003cp\u003eAnd now we are in the \u003ca href=\"https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-16.html#%25_sec_2.3\"\u003emiddle of second chapter\u003c/a\u003e.\u003c/p\u003e","content":"\u003cp\u003eI decided to skip picture language, because of technical reasons. Also, 2.3.1 I'll do in this post, because it was just to short. Here we get one step clother to build interpreter, not yet for programming language, but at least for mathematical expressions.\u003c/p\u003e\n\u003cp\u003eAnd now we are in the \u003ca href=\"https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-16.html#%25_sec_2.3\"\u003emiddle of second chapter\u003c/a\u003e.\u003c/p\u003e\n\u003ch2\u003eExercise 2.54\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-scheme\"\u003e(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eequal?\u003c/span\u003e\u003c/span\u003e l1 l2)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003epair?\u003c/span\u003e\u003c/span\u003e l1)\n    (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003epair?\u003c/span\u003e\u003c/span\u003e l2)\n      (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eequal?\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecar\u003c/span\u003e\u003c/span\u003e l1) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecar\u003c/span\u003e\u003c/span\u003e l2))\n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eequal?\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecdr\u003c/span\u003e\u003c/span\u003e l1) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecdr\u003c/span\u003e\u003c/span\u003e l2))\n        \u003cspan class=\"hljs-literal\"\u003e#f\u003c/span\u003e\n      )\n      \u003cspan class=\"hljs-literal\"\u003e#f\u003c/span\u003e\n    )\n    (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003epair?\u003c/span\u003e\u003c/span\u003e l2)\n      \u003cspan class=\"hljs-literal\"\u003e#f\u003c/span\u003e\n      (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eeq?\u003c/span\u003e\u003c/span\u003e l1 l2) \n    )\n  )\n)\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eequal?\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003elist\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e) '(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e))\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eequal?\u003c/span\u003e\u003c/span\u003e '() '())\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eequal?\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'a\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'a\u003c/span\u003e)\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eequal?\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'a\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'b\u003c/span\u003e)\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eequal?\u003c/span\u003e\u003c/span\u003e '(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e) '(list \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e))\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eExercise 2.55\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003e''abracadabra\u003c/code\u003e is actually a \u003ccode\u003e(quote (quote abracadabra))\u003c/code\u003e which has value \u003ccode\u003e(quote abracadabra)\u003c/code\u003e, and \u003ccode\u003ecar\u003c/code\u003e of it is \u003ccode\u003equote\u003c/code\u003e.\u003c/p\u003e\n\u003ch2\u003eExercise 2.56\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-scheme\"\u003e(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003evariable?\u003c/span\u003e x) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003esymbol?\u003c/span\u003e\u003c/span\u003e x))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003esame-variable?\u003c/span\u003e v1 v2)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eand\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003evariable?\u003c/span\u003e v1) (\u003cspan class=\"hljs-name\"\u003evariable?\u003c/span\u003e v2) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eeq?\u003c/span\u003e\u003c/span\u003e v1 v2)))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e exp num)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eand\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003enumber?\u003c/span\u003e\u003c/span\u003e exp) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003e=\u003c/span\u003e\u003c/span\u003e exp num)))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-sum\u003c/span\u003e a1 a2)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003econd\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e a1 \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) a2)\n        ((\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e a2 \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) a1)\n        ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eand\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003enumber?\u003c/span\u003e\u003c/span\u003e a1) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003enumber?\u003c/span\u003e\u003c/span\u003e a2)) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003e+\u003c/span\u003e\u003c/span\u003e a1 a2))\n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eelse\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003elist\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'+\u003c/span\u003e a1 a2))))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-product\u003c/span\u003e m1 m2)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003econd\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eor\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e m1 \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) (\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e m2 \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)) \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n        ((\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e m1 \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) m2)\n        ((\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e m2 \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) m1)\n        ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eand\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003enumber?\u003c/span\u003e\u003c/span\u003e m1) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003enumber?\u003c/span\u003e\u003c/span\u003e m2)) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003e*\u003c/span\u003e\u003c/span\u003e m1 m2))\n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eelse\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003elist\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'*\u003c/span\u003e m1 m2))))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003esum?\u003c/span\u003e x)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eand\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003epair?\u003c/span\u003e\u003c/span\u003e x) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eeq?\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecar\u003c/span\u003e\u003c/span\u003e x) \u003cspan class=\"hljs-symbol\"\u003e'+\u003c/span\u003e)))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eaddend\u003c/span\u003e s) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecadr\u003c/span\u003e\u003c/span\u003e s))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eaugend\u003c/span\u003e s) (\u003cspan class=\"hljs-name\"\u003ecaddr\u003c/span\u003e s))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eproduct?\u003c/span\u003e x)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eand\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003epair?\u003c/span\u003e\u003c/span\u003e x) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eeq?\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecar\u003c/span\u003e\u003c/span\u003e x) \u003cspan class=\"hljs-symbol\"\u003e'*\u003c/span\u003e)))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emultiplier\u003c/span\u003e p) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecadr\u003c/span\u003e\u003c/span\u003e p))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emultiplicand\u003c/span\u003e p) (\u003cspan class=\"hljs-name\"\u003ecaddr\u003c/span\u003e p))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eexponentiation?\u003c/span\u003e x)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eand\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003epair?\u003c/span\u003e\u003c/span\u003e x) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eeq?\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecar\u003c/span\u003e\u003c/span\u003e x) \u003cspan class=\"hljs-symbol\"\u003e'**\u003c/span\u003e)))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ebase\u003c/span\u003e e) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecadr\u003c/span\u003e\u003c/span\u003e e))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eexponent\u003c/span\u003e e) (\u003cspan class=\"hljs-name\"\u003ecaddr\u003c/span\u003e e))\n \n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-exponentiation\u003c/span\u003e base e)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003econd\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n        ((\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) base)\n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eelse\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003elist\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'**\u003c/span\u003e base e))))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ederiv\u003c/span\u003e exp var)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003econd\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003enumber?\u003c/span\u003e\u003c/span\u003e exp) \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n        ((\u003cspan class=\"hljs-name\"\u003evariable?\u003c/span\u003e exp)\n         (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003esame-variable?\u003c/span\u003e exp var) \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e))\n        ((\u003cspan class=\"hljs-name\"\u003esum?\u003c/span\u003e exp)\n         (\u003cspan class=\"hljs-name\"\u003emake-sum\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ederiv\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eaddend\u003c/span\u003e exp) var)\n                   (\u003cspan class=\"hljs-name\"\u003ederiv\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eaugend\u003c/span\u003e exp) var)))\n        ((\u003cspan class=\"hljs-name\"\u003eproduct?\u003c/span\u003e exp)\n         (\u003cspan class=\"hljs-name\"\u003emake-sum\u003c/span\u003e\n           (\u003cspan class=\"hljs-name\"\u003emake-product\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emultiplier\u003c/span\u003e exp)\n                         (\u003cspan class=\"hljs-name\"\u003ederiv\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emultiplicand\u003c/span\u003e exp) var))\n           (\u003cspan class=\"hljs-name\"\u003emake-product\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ederiv\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emultiplier\u003c/span\u003e exp) var)\n                         (\u003cspan class=\"hljs-name\"\u003emultiplicand\u003c/span\u003e exp))))\n        ((\u003cspan class=\"hljs-name\"\u003eexponentiation?\u003c/span\u003e exp)\n         (\u003cspan class=\"hljs-name\"\u003emake-product\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eexponent\u003c/span\u003e exp) (\u003cspan class=\"hljs-name\"\u003emake-exponentiation\u003c/span\u003e \n                (\u003cspan class=\"hljs-name\"\u003ebase\u003c/span\u003e exp)\n                (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003e-\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eexponent\u003c/span\u003e exp) \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n            )))\n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eelse\u003c/span\u003e\u003c/span\u003e\n         (\u003cspan class=\"hljs-name\"\u003eerror\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"unknown expression type -- DERIV\"\u003c/span\u003e exp))))\n\n\n(\u003cspan class=\"hljs-name\"\u003ederiv\u003c/span\u003e '(+ (** x \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e) (** x \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)) \u003cspan class=\"hljs-symbol\"\u003e'x\u003c/span\u003e)\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eExercise 2.57\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-scheme\"\u003e(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-sum\u003c/span\u003e a1 a2)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003econd\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e a1 \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) a2)\n        ((\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e a2 \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) a1)\n        ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eand\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003enumber?\u003c/span\u003e\u003c/span\u003e a1) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003enumber?\u003c/span\u003e\u003c/span\u003e a2)) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003e+\u003c/span\u003e\u003c/span\u003e a1 a2))\n        ((\u003cspan class=\"hljs-name\"\u003esum?\u003c/span\u003e a2) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eappend\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003elist\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'+\u003c/span\u003e a1) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecdr\u003c/span\u003e\u003c/span\u003e a2)))\n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eelse\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003elist\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'+\u003c/span\u003e a1 a2))))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eaddend\u003c/span\u003e s) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecadr\u003c/span\u003e\u003c/span\u003e s))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eaugend\u003c/span\u003e s) \n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003enull?\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ecdddr\u003c/span\u003e s))\n    (\u003cspan class=\"hljs-name\"\u003ecaddr\u003c/span\u003e s)\n    (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003econs\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'+\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ecddr\u003c/span\u003e s))))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-product\u003c/span\u003e m1 m2)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003econd\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eor\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e m1 \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) (\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e m2 \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)) \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n        ((\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e m1 \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) m2)\n        ((\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e m2 \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) m1)\n        ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eand\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003enumber?\u003c/span\u003e\u003c/span\u003e m1) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003enumber?\u003c/span\u003e\u003c/span\u003e m2)) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003e*\u003c/span\u003e\u003c/span\u003e m1 m2))\n        ((\u003cspan class=\"hljs-name\"\u003eproduct?\u003c/span\u003e m2) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eappend\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003elist\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'*\u003c/span\u003e m1) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecdr\u003c/span\u003e\u003c/span\u003e m2)))\n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eelse\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003elist\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'*\u003c/span\u003e m1 m2))))\n\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emultiplier\u003c/span\u003e p) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecadr\u003c/span\u003e\u003c/span\u003e p))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emultiplicand\u003c/span\u003e s) \n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003enull?\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ecdddr\u003c/span\u003e s))\n    (\u003cspan class=\"hljs-name\"\u003ecaddr\u003c/span\u003e s)\n    (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003econs\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'*\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ecddr\u003c/span\u003e s))))\n\n(\u003cspan class=\"hljs-name\"\u003ederiv\u003c/span\u003e '(+ x (* x x x) (** x \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e)) \u003cspan class=\"hljs-symbol\"\u003e'x\u003c/span\u003e)\n\u003cspan class=\"hljs-comment\"\u003e;Value 30: (+ 1 (+ (* x (+ x x)) (* x x)) (* 3 (** x 2)))\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eExercise 2.58\u003c/h2\u003e\n\u003cp\u003eSo, we want this to work:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-scheme\"\u003e(\u003cspan class=\"hljs-name\"\u003ederiv\u003c/span\u003e '(x + x**2 + \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e * x**3) \u003cspan class=\"hljs-symbol\"\u003e'x\u003c/span\u003e)\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAt first I wanted to add some parsing step that converts this to lisp, and then reread requirements, and found this: \"Can you design appropriate predicates, selectors, and constructors for this notation such that our derivative program still works?\"\u003c/p\u003e\n\u003cp\u003eSo, no transformation, this should be the format of data, and we need to change functions that work with it.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-scheme\"\u003e(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003epriority\u003c/span\u003e sym)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003econd\u003c/span\u003e\u003c/span\u003e \n    ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eeq?\u003c/span\u003e\u003c/span\u003e sym \u003cspan class=\"hljs-symbol\"\u003e'+\u003c/span\u003e) \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n    ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eeq?\u003c/span\u003e\u003c/span\u003e sym \u003cspan class=\"hljs-symbol\"\u003e'*\u003c/span\u003e) \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)\n    ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eeq?\u003c/span\u003e\u003c/span\u003e sym \u003cspan class=\"hljs-symbol\"\u003e'**\u003c/span\u003e) \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e)\n    ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003enumber?\u003c/span\u003e\u003c/span\u003e sym) \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e)\n    ((\u003cspan class=\"hljs-name\"\u003evariable?\u003c/span\u003e sym) \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e)\n    ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003epair?\u003c/span\u003e\u003c/span\u003e sym) \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e)\n    (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eelse\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eerror\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"unknown symbol --priority\"\u003c/span\u003e sym))\n  )\n)\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eleast-priority-operation\u003c/span\u003e exp)\n    (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eiter\u003c/span\u003e op min-pr exp)\n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003enull?\u003c/span\u003e\u003c/span\u003e exp)\n            op\n            (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003elet\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003enp\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003epriority\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecar\u003c/span\u003e\u003c/span\u003e exp))))\n                (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003e\u0026#x3C;\u003c/span\u003e\u003c/span\u003e np min-pr)\n                    (\u003cspan class=\"hljs-name\"\u003eiter\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecar\u003c/span\u003e\u003c/span\u003e exp) np (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecdr\u003c/span\u003e\u003c/span\u003e exp))\n                    (\u003cspan class=\"hljs-name\"\u003eiter\u003c/span\u003e op min-pr (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecdr\u003c/span\u003e\u003c/span\u003e exp))\n                )\n            )\n        )\n    )\n    (\u003cspan class=\"hljs-name\"\u003eiter\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecar\u003c/span\u003e\u003c/span\u003e exp) (\u003cspan class=\"hljs-name\"\u003epriority\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecar\u003c/span\u003e\u003c/span\u003e exp)) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecdr\u003c/span\u003e\u003c/span\u003e exp))\n)\n\n(\u003cspan class=\"hljs-name\"\u003eleast-priority-operation\u003c/span\u003e '(x + x**2 + \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e * x**3))\n(\u003cspan class=\"hljs-name\"\u003eleast-priority-operation\u003c/span\u003e '(x * y ** \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e))\n(\u003cspan class=\"hljs-name\"\u003eleast-priority-operation\u003c/span\u003e '(y ** \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eunwrap\u003c/span\u003e val) \n    (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eand\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003epair?\u003c/span\u003e\u003c/span\u003e val) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003enull?\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecdr\u003c/span\u003e\u003c/span\u003e val)))\n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecar\u003c/span\u003e\u003c/span\u003e val)\n        val\n    )\n)\n\n\u003cspan class=\"hljs-comment\"\u003e; Return part of expression before first appearance of given symbol\u003c/span\u003e\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ebefore\u003c/span\u003e sym exp)\n    (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eor\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003enull?\u003c/span\u003e\u003c/span\u003e exp) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eeq?\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecar\u003c/span\u003e\u003c/span\u003e exp) sym))\n        '()\n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003econs\u003c/span\u003e\u003c/span\u003e\n            (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecar\u003c/span\u003e\u003c/span\u003e exp)\n            (\u003cspan class=\"hljs-name\"\u003ebefore\u003c/span\u003e sym (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecdr\u003c/span\u003e\u003c/span\u003e exp))\n        )\n    )\n)\n\n(\u003cspan class=\"hljs-name\"\u003ebefore\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'+\u003c/span\u003e '(y ** \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e))\n\n\u003cspan class=\"hljs-comment\"\u003e; Return part of expression after symbol\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; BTW, for division to work properly we need to take last occurence here, but \u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; as we don't have division - I'll leave it with first\u003c/span\u003e\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eafter\u003c/span\u003e sym exp)\n    (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003enull?\u003c/span\u003e\u003c/span\u003e exp)\n        '()\n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eif\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eeq?\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecar\u003c/span\u003e\u003c/span\u003e exp) sym)\n            (\u003cspan class=\"hljs-name\"\u003eunwrap\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecdr\u003c/span\u003e\u003c/span\u003e exp))\n            (\u003cspan class=\"hljs-name\"\u003eafter\u003c/span\u003e sym (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003ecdr\u003c/span\u003e\u003c/span\u003e exp))\n        )\n    )\n)\n\n(\u003cspan class=\"hljs-name\"\u003eafter\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'+\u003c/span\u003e '(y ** \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-sum\u003c/span\u003e a1 a2)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003econd\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e a1 \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) a2)\n        ((\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e a2 \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) a1)\n        ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eand\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003enumber?\u003c/span\u003e\u003c/span\u003e a1) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003enumber?\u003c/span\u003e\u003c/span\u003e a2)) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003e+\u003c/span\u003e\u003c/span\u003e a1 a2))\n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eelse\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003elist\u003c/span\u003e\u003c/span\u003e a1 \u003cspan class=\"hljs-symbol\"\u003e'+\u003c/span\u003e a2))))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-product\u003c/span\u003e m1 m2)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003econd\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eor\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e m1 \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) (\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e m2 \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)) \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e)\n        ((\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e m1 \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) m2)\n        ((\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e m2 \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) m1)\n        ((\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eand\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003enumber?\u003c/span\u003e\u003c/span\u003e m1) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003enumber?\u003c/span\u003e\u003c/span\u003e m2)) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003e*\u003c/span\u003e\u003c/span\u003e m1 m2))\n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eelse\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003elist\u003c/span\u003e\u003c/span\u003e m1 \u003cspan class=\"hljs-symbol\"\u003e'*\u003c/span\u003e m2))))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003esum?\u003c/span\u003e x)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eand\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003epair?\u003c/span\u003e\u003c/span\u003e x) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eeq?\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eleast-priority-operation\u003c/span\u003e x) \u003cspan class=\"hljs-symbol\"\u003e'+\u003c/span\u003e)))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eaddend\u003c/span\u003e s) (\u003cspan class=\"hljs-name\"\u003eunwrap\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ebefore\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'+\u003c/span\u003e s)))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eaugend\u003c/span\u003e s) (\u003cspan class=\"hljs-name\"\u003eafter\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'+\u003c/span\u003e s))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eproduct?\u003c/span\u003e x)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eand\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003epair?\u003c/span\u003e\u003c/span\u003e x) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eeq?\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eleast-priority-operation\u003c/span\u003e x) \u003cspan class=\"hljs-symbol\"\u003e'*\u003c/span\u003e)))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emultiplier\u003c/span\u003e p) (\u003cspan class=\"hljs-name\"\u003eunwrap\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ebefore\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'*\u003c/span\u003e p)))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emultiplicand\u003c/span\u003e p) (\u003cspan class=\"hljs-name\"\u003eafter\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'*\u003c/span\u003e p))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eexponentiation?\u003c/span\u003e x)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eand\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003epair?\u003c/span\u003e\u003c/span\u003e x) (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eeq?\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eleast-priority-operation\u003c/span\u003e x) \u003cspan class=\"hljs-symbol\"\u003e'**\u003c/span\u003e)))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ebase\u003c/span\u003e e) (\u003cspan class=\"hljs-name\"\u003eunwrap\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003ebefore\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'**\u003c/span\u003e e)))\n\n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003eexponent\u003c/span\u003e e) (\u003cspan class=\"hljs-name\"\u003eafter\u003c/span\u003e \u003cspan class=\"hljs-symbol\"\u003e'**\u003c/span\u003e e))\n \n(\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003edefine\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003emake-exponentiation\u003c/span\u003e base e)\n  (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003econd\u003c/span\u003e\u003c/span\u003e ((\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n        ((\u003cspan class=\"hljs-name\"\u003e=number?\u003c/span\u003e e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) base)\n        (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003eelse\u003c/span\u003e\u003c/span\u003e (\u003cspan class=\"hljs-name\"\u003e\u003cspan class=\"hljs-builtin-name\"\u003elist\u003c/span\u003e\u003c/span\u003e base \u003cspan class=\"hljs-symbol\"\u003e'**\u003c/span\u003e e))))\n\n(\u003cspan class=\"hljs-name\"\u003ederiv\u003c/span\u003e '(x + x ** \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e * x ** \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e) \u003cspan class=\"hljs-symbol\"\u003e'x\u003c/span\u003e)\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis is rather ugly (I don't like \u003ccode\u003ebefore\u003c/code\u003e, \u003ccode\u003eafter\u003c/code\u003e, \u003ccode\u003eunwrap\u003c/code\u003e etc., it does not seem very performant to use them), but I see we will have another example Symbolic Algebra later, maybe there will be a chance to make it better.\u003c/p\u003e"},"archives":[{"url":"/month/2021-01/page/1","id":"2021-01","count":4,"title":"2021-01"},{"url":"/month/2020-12/page/1","id":"2020-12","count":1,"title":"2020-12"},{"url":"/month/2020-09/page/1","id":"2020-09","count":2,"title":"2020-09"},{"url":"/month/2020-08/page/1","id":"2020-08","count":2,"title":"2020-08"},{"url":"/month/2020-07/page/1","id":"2020-07","count":10,"title":"2020-07"},{"url":"/month/2020-06/page/1","id":"2020-06","count":7,"title":"2020-06"},{"url":"/month/2018-12/page/1","id":"2018-12","count":1,"title":"2018-12"}],"topics":[{"url":"/tag/MOOC/page/1","id":"MOOC","title":"MOOC","count":2},{"url":"/tag/SICP/page/1","id":"SICP","title":"SICP","count":20},{"url":"/tag/ideas/page/1","id":"ideas","title":"ideas","count":1},{"url":"/tag/notes/page/1","id":"notes","title":"notes","count":5},{"url":"/tag/on writing/page/1","id":"on writing","title":"on writing","count":3}]},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"sicp2.3.2"},"buildId":"sMnLAto4YhgRliyLu0bmY","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>