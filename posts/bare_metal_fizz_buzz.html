<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Bare metal &quot;Fizz Buzz&quot;</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/e3ab5a804ab9e404.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e3ab5a804ab9e404.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-514908bffb652963.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-6099a486a931d74e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9ca9bb1f507791d0.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-e383908e480c879a.js" defer=""></script><script src="/_next/static/MGOI-P4iVCBMhDsEh3Q1E/_buildManifest.js" defer=""></script><script src="/_next/static/MGOI-P4iVCBMhDsEh3Q1E/_ssgManifest.js" defer=""></script><script src="/_next/static/MGOI-P4iVCBMhDsEh3Q1E/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><h1 id="top">Taras Bunyk</h1><nav><a href="/">Home</a><a href="http://bunyk.github.io/mandala/">Snowflake drawing</a><a href="/resume">Resume</a><a href="https://bunyk.wordpress.com/">Old blog (in Ukrainian)</a></nav><article><h1>Bare metal &quot;Fizz Buzz&quot;</h1><div>Published: 2021-10-31</div><div><p>Being able to write <a href="http://bunyk.github.io/posts/bare_metal_hello_world">hello world</a> would not get you a job. To be able to get a job, you need to at least be able to write program called "<a href="https://en.wikipedia.org/wiki/Fizz_buzz#Programming">fizz buzz</a>". Yes, really, on one interview I was asked to write such program.</p>
<p>It's hard to design such a program without subroutines to print different strings and numbers, so we would need to learn how to add subroutines to assembler.</p>
<h2>New way to jump around</h2>
<p>To have subroutines we need just two instructions, <code>call</code>, and <code>ret</code>.</p>
<p>Call is almost the same as <code>jmp</code>, but in addition it writes the address of next instruction to the stack, so <code>ret</code> knows where to return. We could return also by using <code>jmp</code>, but if we call our subroutine from two different places, <code>jmp</code> would not know where to jump.</p>
<p>There is special register called <code>ip</code>, that has address of instruction currently executed, but we could not read or manipulate it directly (on <code>x86</code> processors).</p>
<p>Additionally, it is nice behaviour for the subroutines to <code>push</code> values of the registers they will mess with to the stack, and then <code>pop</code> them before return, so code that calls subroutines, could use that registers for other computations.</p>
<p>So, knowing all this, routine to print a string could look like this:</p>
<pre><code class="hljs language-x86asm"><span class="hljs-comment">; println routine prints null-terminated string to which bx points</span>
<span class="hljs-symbol">println:</span>
	<span class="hljs-keyword">push</span> <span class="hljs-built_in">ax</span> <span class="hljs-comment">; save ax, and bx, since their values will be changed</span>
	<span class="hljs-keyword">push</span> <span class="hljs-built_in">bx</span>

	<span class="hljs-keyword">mov</span> <span class="hljs-number">ah</span>, <span class="hljs-number">0x0e</span><span class="hljs-comment">; teletype mode</span>
<span class="hljs-symbol">
	print_loop:</span> 
		<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>, [<span class="hljs-built_in">bx</span>] <span class="hljs-comment">; prepare to print character to which bx points now</span>

		<span class="hljs-keyword">cmp</span> <span class="hljs-built_in">al</span>, <span class="hljs-number">0</span>    <span class="hljs-comment">; is it 0?</span>
		<span class="hljs-keyword">je</span> finish_print    <span class="hljs-comment">; if yes - jump to finish_print</span>

		<span class="hljs-keyword">int</span> <span class="hljs-number">0x10</span> 	 <span class="hljs-comment">; print current character</span>

		<span class="hljs-keyword">inc</span> <span class="hljs-built_in">bx</span> 		 <span class="hljs-comment">; go to next byte</span>
	<span class="hljs-keyword">jmp</span> print_loop
<span class="hljs-symbol">
	finish_print:</span>
	<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>, <span class="hljs-number">13</span> <span class="hljs-comment">; print \r, moves to beginning of line</span>
	<span class="hljs-keyword">int</span> <span class="hljs-number">0x10</span>
	<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>, <span class="hljs-number">10</span> <span class="hljs-comment">; print \n, moves to new line</span>
	<span class="hljs-keyword">int</span> <span class="hljs-number">0x10</span>

	<span class="hljs-keyword">pop</span> <span class="hljs-built_in">bx</span> <span class="hljs-comment">; restore values of registers</span>
	<span class="hljs-keyword">pop</span> <span class="hljs-built_in">ax</span>
<span class="hljs-keyword">ret</span> <span class="hljs-comment">; return to caller</span></code></pre>
<p>Having this subroutine, to print two different lines, we just write this code:</p>
<pre><code class="hljs language-x86asm"><span class="hljs-keyword">mov</span> <span class="hljs-built_in">bx</span>, msg <span class="hljs-comment">; put address of message to bx</span>
<span class="hljs-keyword">call</span> println <span class="hljs-comment">; print what bx points to</span>

<span class="hljs-keyword">mov</span> <span class="hljs-built_in">bx</span>, msg2  <span class="hljs-comment">; print msg2</span>
<span class="hljs-keyword">call</span> println

<span class="hljs-keyword">jmp</span> $ <span class="hljs-comment">; loop forever</span>
<span class="hljs-symbol">
msg:</span> 
<span class="hljs-built_in">db</span> <span class="hljs-string">"Fizz"</span>,<span class="hljs-number">0</span>
<span class="hljs-symbol">
msg2:</span> 
<span class="hljs-built_in">db</span> <span class="hljs-string">"Buzz!"</span>,<span class="hljs-number">0</span></code></pre>
<h2>Arithmetic's</h2>
<p>To print number, we need to know it's digits, and to know it's digits, we need to be able to divide and find a remainder of division.</p>
<p>That is tricky to do in assembly, since <code>div</code> instruction has no parameters like <code>div z, x, y ; same as z = x/y</code> that I imagined.</p>
<p>Turns out it has single argument, and that argument could not be a constant, it should be register, or address of memory. And size of that argument defines how <code>div</code> would behave. For 16 bit register, div will divide <code>dx:ax</code> by that register, and after this <code>ax</code> will store the result of division, <code>dx</code> will store the remainder.</p>
<p>So, if we want to check if some 16 bit integer is divisible by 3, we need to do this:</p>
<ol>
<li>Put it into <code>ax</code></li>
<li>Put 0 into <code>dx</code>, to make sure value from there does not influence result.</li>
<li>Put 3 into <code>bx</code> (or <code>cx</code>)</li>
<li>Finally, call <code>div bx</code> (or <code>div cx</code>)</li>
<li>Now check if value in <code>dx</code> is 0, and jump depending on that.</li>
</ol>
<p>Using this, section of code that prints string addressed by label <code>fizzbuzz</code>, if <code>ax</code> is divisible by 15 looks like this:</p>
<pre><code class="hljs language-x86asm">	<span class="hljs-keyword">push</span> <span class="hljs-built_in">ax</span> <span class="hljs-comment">; store ax, because it will be modified</span>

	<span class="hljs-keyword">mov</span> <span class="hljs-built_in">dx</span>, <span class="hljs-number">0</span>  <span class="hljs-comment">; div, divides dx:ax number by it's argument, but we want only ax</span>
	<span class="hljs-keyword">mov</span> <span class="hljs-built_in">bx</span>, <span class="hljs-number">15</span> <span class="hljs-comment">; div is not able to work with constants, so use bx to store 15</span>
	<span class="hljs-keyword">div</span> <span class="hljs-built_in">bx</span>     <span class="hljs-comment">; divide dx:ax by bx. After this ax = ax / bx; dx = ax % bx;</span>

	<span class="hljs-keyword">pop</span> <span class="hljs-built_in">ax</span><span class="hljs-comment">; restore ax</span>

	<span class="hljs-keyword">cmp</span> <span class="hljs-built_in">dx</span>, <span class="hljs-number">0</span>  <span class="hljs-comment">; was it divisible by 15 ? </span>
	<span class="hljs-keyword">jne</span> check_fizz <span class="hljs-comment">; if not - try with 5</span>

	<span class="hljs-keyword">mov</span> <span class="hljs-built_in">bx</span>, fizzbuzz <span class="hljs-comment">; if yes - print fizzbuzz</span>
	<span class="hljs-keyword">call</span> println</code></pre>
<p>While programming in assembly, I feel like I need more registers, and a way to give them better names than just two letters. I miss variables.</p>
<p>Maybe people who actually know assembly know how to use memory addresses as variables, I'm instead trying to stick to this 4 general purpose registers.</p>
<h2>Printing decimals</h2>
<p>Ok, now we are able to print any string by it's address, and we are able to do division. The only thing left is to print decimal numbers.</p>
<p>For that - we just loop over all the digits, and print each. The only hard thing is that it is hard to know with which digit the number starts. It is easier to know with which digit it ends, because it's the remainder of division by 10. The digit that ends our number divided by 10 - is the second digit, etc... We could divide by 10 in each iteration, and get digits in reverse.</p>
<p>But we could push all of them to the stack, and then just pop and print, that would print them in normal order.</p>
<p>My decimal number printing code looks like this:</p>
<pre><code class="hljs language-x86asm"><span class="hljs-comment">; print_decimal routine prints number stored in ax</span>
<span class="hljs-symbol">print_decimal:</span>
	<span class="hljs-keyword">push</span> <span class="hljs-built_in">ax</span> <span class="hljs-comment">; store values of registers that will change</span>
	<span class="hljs-keyword">push</span> <span class="hljs-built_in">bx</span>
	<span class="hljs-keyword">push</span> <span class="hljs-built_in">cx</span>
	<span class="hljs-keyword">push</span> <span class="hljs-built_in">dx</span>

	<span class="hljs-keyword">mov</span> <span class="hljs-built_in">cx</span>, <span class="hljs-number">0</span> <span class="hljs-comment">; cx will hold number of digits, initially 0</span>

	<span class="hljs-keyword">cmp</span> <span class="hljs-built_in">ax</span>, <span class="hljs-number">0</span> <span class="hljs-comment">; is number we want to print 0? </span>
	<span class="hljs-keyword">jne</span> push_last_digit <span class="hljs-comment">; if not - proceed to pushing last digit of it</span>
	<span class="hljs-keyword">push</span> <span class="hljs-number">0</span> <span class="hljs-comment">; digit is 0</span>
	<span class="hljs-keyword">mov</span> <span class="hljs-built_in">cx</span>, <span class="hljs-number">1</span> <span class="hljs-comment">; number of digits in stack is 1</span>
	<span class="hljs-keyword">jmp</span> print_from_stack <span class="hljs-comment">; and print this</span>
<span class="hljs-symbol">
	push_last_digit:</span>
		<span class="hljs-keyword">mov</span> <span class="hljs-built_in">dx</span>, <span class="hljs-number">0</span>  <span class="hljs-comment">; div, divides dx:ax number by it's argument, but we want only ax</span>
		<span class="hljs-keyword">mov</span> <span class="hljs-built_in">bx</span>, <span class="hljs-number">10</span> <span class="hljs-comment">; div is not able to work with constants, so use bx to store 10</span>
		<span class="hljs-keyword">div</span> <span class="hljs-built_in">bx</span>     <span class="hljs-comment">; divide dx:ax by bx. After this ax = ax / bx; dx = ax % bx;</span>

		<span class="hljs-keyword">push</span> <span class="hljs-built_in">dx</span>   <span class="hljs-comment">; dx is last digit, put it in stack</span>
		<span class="hljs-keyword">inc</span> <span class="hljs-built_in">cx</span>    <span class="hljs-comment">; we have one more digit to print</span>

	<span class="hljs-keyword">cmp</span> <span class="hljs-built_in">ax</span>, <span class="hljs-number">0</span> <span class="hljs-comment">; do we still have numbers?</span>
	<span class="hljs-keyword">jne</span> push_last_digit <span class="hljs-comment">; if yes - push that again</span>
<span class="hljs-symbol">
	print_from_stack:</span>
		<span class="hljs-keyword">cmp</span> <span class="hljs-built_in">cx</span>, <span class="hljs-number">0</span> <span class="hljs-comment">; are there numbers to print?</span>
		<span class="hljs-keyword">je</span> exit_print_decimal<span class="hljs-comment">; if no - finish subroutine</span>

		<span class="hljs-keyword">pop</span> <span class="hljs-built_in">bx</span>  <span class="hljs-comment">; put number to print into bx</span>
		<span class="hljs-keyword">add</span> <span class="hljs-built_in">bx</span>, <span class="hljs-string">'0'</span> <span class="hljs-comment">; add to bx ASCII code of 0</span>
		<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>, <span class="hljs-built_in">bl</span>  <span class="hljs-comment">; put that code to AL</span>

		<span class="hljs-keyword">mov</span> <span class="hljs-number">ah</span>, <span class="hljs-number">0x0e</span><span class="hljs-comment">; teletype mode</span>
		<span class="hljs-keyword">int</span> <span class="hljs-number">0x10</span> 	 <span class="hljs-comment">; print current digit</span>

		<span class="hljs-keyword">dec</span> <span class="hljs-built_in">cx</span> <span class="hljs-comment">; and now we have one less digit to print</span>
	<span class="hljs-keyword">jmp</span> print_from_stack
<span class="hljs-symbol">
	exit_print_decimal:</span>

	<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>, <span class="hljs-number">13</span> <span class="hljs-comment">; print \r, moves to beginning of line</span>
	<span class="hljs-keyword">int</span> <span class="hljs-number">0x10</span>
	<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>, <span class="hljs-number">10</span> <span class="hljs-comment">; print \n, moves to new line</span>
	<span class="hljs-keyword">int</span> <span class="hljs-number">0x10</span>

	<span class="hljs-keyword">pop</span> <span class="hljs-built_in">dx</span> <span class="hljs-comment">; restore registers</span>
	<span class="hljs-keyword">pop</span> <span class="hljs-built_in">cx</span> 
	<span class="hljs-keyword">pop</span> <span class="hljs-built_in">bx</span> 
	<span class="hljs-keyword">pop</span> <span class="hljs-built_in">ax</span>
<span class="hljs-keyword">ret</span></code></pre>
<h2>Slowing down</h2>
<p>And our FizzBuzz runs so fast that it's impossible to read anything, I found out how to ask BIOS to wait for some time:</p>
<pre><code class="hljs language-x86asm"><span class="hljs-comment">; sleep about cx/15 seconds</span>
<span class="hljs-comment">; CX:DX = interval in microseconds, if we don't set dx - one cx is ~65536A microseconds, or 1/15 of second</span>
<span class="hljs-symbol">sleep:</span>
	<span class="hljs-keyword">push</span> <span class="hljs-built_in">ax</span>

	<span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>, <span class="hljs-number">0</span>
	<span class="hljs-keyword">mov</span> <span class="hljs-number">ah</span>, <span class="hljs-number">0x86</span>
	<span class="hljs-keyword">int</span> <span class="hljs-number">0x15</span>

	<span class="hljs-keyword">pop</span> <span class="hljs-built_in">ax</span>
<span class="hljs-keyword">ret</span></code></pre>
<h2>Main FizzBuzz loop</h2>
<p>Having all that subroutines in place, FizzBuzz looks like this:</p>
<pre><code class="hljs language-x86asm"><span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>, <span class="hljs-number">0</span> <span class="hljs-comment">; loop counter</span>
<span class="hljs-keyword">mov</span> <span class="hljs-built_in">cx</span>, <span class="hljs-number">5</span> <span class="hljs-comment">; how long to sleep in 1/15th of second</span>
<span class="hljs-symbol">
loop:</span>
	<span class="hljs-keyword">inc</span> <span class="hljs-built_in">ax</span>
	<span class="hljs-keyword">call</span> sleep

	<span class="hljs-keyword">push</span> <span class="hljs-built_in">ax</span> <span class="hljs-comment">; store ax, because it will be modified</span>

	<span class="hljs-keyword">mov</span> <span class="hljs-built_in">dx</span>, <span class="hljs-number">0</span>  <span class="hljs-comment">; div, divides dx:ax number by it's argument, but we want only ax</span>
	<span class="hljs-keyword">mov</span> <span class="hljs-built_in">bx</span>, <span class="hljs-number">15</span> <span class="hljs-comment">; div is not able to work with constants, so use bx to store 15</span>
	<span class="hljs-keyword">div</span> <span class="hljs-built_in">bx</span>     <span class="hljs-comment">; divide dx:ax by bx. After this ax = ax / bx; dx = ax % bx;</span>

	<span class="hljs-keyword">pop</span> <span class="hljs-built_in">ax</span><span class="hljs-comment">; restore ax</span>

	<span class="hljs-keyword">cmp</span> <span class="hljs-built_in">dx</span>, <span class="hljs-number">0</span>  <span class="hljs-comment">; was it divisible by 15 ? </span>
	<span class="hljs-keyword">jne</span> check_fizz <span class="hljs-comment">; if not - try with 5</span>

	<span class="hljs-keyword">mov</span> <span class="hljs-built_in">bx</span>, fizzbuzz <span class="hljs-comment">; if yes - print fizzbuzz</span>
	<span class="hljs-keyword">call</span> println
	<span class="hljs-keyword">jmp</span> <span class="hljs-keyword">loop</span> <span class="hljs-comment">; continue with next iteration</span>
<span class="hljs-symbol">
	check_fizz:</span>
	<span class="hljs-keyword">push</span> <span class="hljs-built_in">ax</span>

	<span class="hljs-keyword">mov</span> <span class="hljs-built_in">dx</span>, <span class="hljs-number">0</span>
	<span class="hljs-keyword">mov</span> <span class="hljs-built_in">bx</span>, <span class="hljs-number">5</span>
	<span class="hljs-keyword">div</span> <span class="hljs-built_in">bx</span>

	<span class="hljs-keyword">pop</span> <span class="hljs-built_in">ax</span>

	<span class="hljs-keyword">cmp</span> <span class="hljs-built_in">dx</span>, <span class="hljs-number">0</span>  <span class="hljs-comment">; was it divisible by 5 ? </span>
	<span class="hljs-keyword">jne</span> check_buzz <span class="hljs-comment">; if not - try with 3</span>

	<span class="hljs-keyword">mov</span> <span class="hljs-built_in">bx</span>, fizz <span class="hljs-comment">; if yes - print fizz</span>
	<span class="hljs-keyword">call</span> println

	<span class="hljs-keyword">jmp</span> <span class="hljs-keyword">loop</span> <span class="hljs-comment">; and move to next number</span>
<span class="hljs-symbol">
	check_buzz:</span>
	<span class="hljs-keyword">push</span> <span class="hljs-built_in">ax</span>

	<span class="hljs-keyword">mov</span> <span class="hljs-built_in">dx</span>, <span class="hljs-number">0</span>
	<span class="hljs-keyword">mov</span> <span class="hljs-built_in">bx</span>, <span class="hljs-number">3</span>
	<span class="hljs-keyword">div</span> <span class="hljs-built_in">bx</span>

	<span class="hljs-keyword">pop</span> <span class="hljs-built_in">ax</span>

	<span class="hljs-keyword">cmp</span> <span class="hljs-built_in">dx</span>, <span class="hljs-number">0</span>  <span class="hljs-comment">; was it divisible by 3 ? </span>
	<span class="hljs-keyword">jne</span> integer <span class="hljs-comment">; not - proceed to printing</span>

	<span class="hljs-keyword">mov</span> <span class="hljs-built_in">bx</span>, buzz <span class="hljs-comment">; if yes - print fizz</span>
	<span class="hljs-keyword">call</span> println

	<span class="hljs-keyword">jmp</span> <span class="hljs-keyword">loop</span>
<span class="hljs-symbol">
	integer:</span>
	<span class="hljs-keyword">call</span> print_decimal
<span class="hljs-keyword">jmp</span> <span class="hljs-keyword">loop</span></code></pre>
<p>Overall code with all the subroutines, constants, and comments takes me 172 lines. A lot for a FizzBuzz, but in Python you would not write two "print" functions for two data types from scratch.</p>
<p>If I remove padding with zeroes, it no longer runs, but binary has just a little over 200 bytes. So, even with my poor assembly skills FizzBuzz could fit into 512 bytes bootsector twice.</p></div></article><nav><a href="/">Home</a><a href="#top">Back to top</a></nav><footer>Â© <!-- -->2021<!-- --> Bunyk Taras. Built with Next.js</footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"id":"bare_metal_fizz_buzz","title":"Bare metal \"Fizz Buzz\"","date":"2021-10-31","tags":["notes","asm"],"content":"\u003cp\u003eBeing able to write \u003ca href=\"http://bunyk.github.io/posts/bare_metal_hello_world\"\u003ehello world\u003c/a\u003e would not get you a job. To be able to get a job, you need to at least be able to write program called \"\u003ca href=\"https://en.wikipedia.org/wiki/Fizz_buzz#Programming\"\u003efizz buzz\u003c/a\u003e\". Yes, really, on one interview I was asked to write such program.\u003c/p\u003e\n\u003cp\u003eIt's hard to design such a program without subroutines to print different strings and numbers, so we would need to learn how to add subroutines to assembler.\u003c/p\u003e\n\u003ch2\u003eNew way to jump around\u003c/h2\u003e\n\u003cp\u003eTo have subroutines we need just two instructions, \u003ccode\u003ecall\u003c/code\u003e, and \u003ccode\u003eret\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eCall is almost the same as \u003ccode\u003ejmp\u003c/code\u003e, but in addition it writes the address of next instruction to the stack, so \u003ccode\u003eret\u003c/code\u003e knows where to return. We could return also by using \u003ccode\u003ejmp\u003c/code\u003e, but if we call our subroutine from two different places, \u003ccode\u003ejmp\u003c/code\u003e would not know where to jump.\u003c/p\u003e\n\u003cp\u003eThere is special register called \u003ccode\u003eip\u003c/code\u003e, that has address of instruction currently executed, but we could not read or manipulate it directly (on \u003ccode\u003ex86\u003c/code\u003e processors).\u003c/p\u003e\n\u003cp\u003eAdditionally, it is nice behaviour for the subroutines to \u003ccode\u003epush\u003c/code\u003e values of the registers they will mess with to the stack, and then \u003ccode\u003epop\u003c/code\u003e them before return, so code that calls subroutines, could use that registers for other computations.\u003c/p\u003e\n\u003cp\u003eSo, knowing all this, routine to print a string could look like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-x86asm\"\u003e\u003cspan class=\"hljs-comment\"\u003e; println routine prints null-terminated string to which bx points\u003c/span\u003e\n\u003cspan class=\"hljs-symbol\"\u003eprintln:\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003epush\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eax\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; save ax, and bx, since their values will be changed\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003epush\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003eah\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0x0e\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e; teletype mode\u003c/span\u003e\n\u003cspan class=\"hljs-symbol\"\u003e\n\tprint_loop:\u003c/span\u003e \n\t\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eal\u003c/span\u003e, [\u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e] \u003cspan class=\"hljs-comment\"\u003e; prepare to print character to which bx points now\u003c/span\u003e\n\n\t\t\u003cspan class=\"hljs-keyword\"\u003ecmp\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eal\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e    \u003cspan class=\"hljs-comment\"\u003e; is it 0?\u003c/span\u003e\n\t\t\u003cspan class=\"hljs-keyword\"\u003eje\u003c/span\u003e finish_print    \u003cspan class=\"hljs-comment\"\u003e; if yes - jump to finish_print\u003c/span\u003e\n\n\t\t\u003cspan class=\"hljs-keyword\"\u003eint\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0x10\u003c/span\u003e \t \u003cspan class=\"hljs-comment\"\u003e; print current character\u003c/span\u003e\n\n\t\t\u003cspan class=\"hljs-keyword\"\u003einc\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e \t\t \u003cspan class=\"hljs-comment\"\u003e; go to next byte\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003ejmp\u003c/span\u003e print_loop\n\u003cspan class=\"hljs-symbol\"\u003e\n\tfinish_print:\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eal\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; print \\r, moves to beginning of line\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003eint\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0x10\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eal\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; print \\n, moves to new line\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003eint\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0x10\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003epop\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; restore values of registers\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003epop\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eax\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eret\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; return to caller\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eHaving this subroutine, to print two different lines, we just write this code:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-x86asm\"\u003e\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e, msg \u003cspan class=\"hljs-comment\"\u003e; put address of message to bx\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003ecall\u003c/span\u003e println \u003cspan class=\"hljs-comment\"\u003e; print what bx points to\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e, msg2  \u003cspan class=\"hljs-comment\"\u003e; print msg2\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003ecall\u003c/span\u003e println\n\n\u003cspan class=\"hljs-keyword\"\u003ejmp\u003c/span\u003e $ \u003cspan class=\"hljs-comment\"\u003e; loop forever\u003c/span\u003e\n\u003cspan class=\"hljs-symbol\"\u003e\nmsg:\u003c/span\u003e \n\u003cspan class=\"hljs-built_in\"\u003edb\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"Fizz\"\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n\u003cspan class=\"hljs-symbol\"\u003e\nmsg2:\u003c/span\u003e \n\u003cspan class=\"hljs-built_in\"\u003edb\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\"Buzz!\"\u003c/span\u003e,\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eArithmetic's\u003c/h2\u003e\n\u003cp\u003eTo print number, we need to know it's digits, and to know it's digits, we need to be able to divide and find a remainder of division.\u003c/p\u003e\n\u003cp\u003eThat is tricky to do in assembly, since \u003ccode\u003ediv\u003c/code\u003e instruction has no parameters like \u003ccode\u003ediv z, x, y ; same as z = x/y\u003c/code\u003e that I imagined.\u003c/p\u003e\n\u003cp\u003eTurns out it has single argument, and that argument could not be a constant, it should be register, or address of memory. And size of that argument defines how \u003ccode\u003ediv\u003c/code\u003e would behave. For 16 bit register, div will divide \u003ccode\u003edx:ax\u003c/code\u003e by that register, and after this \u003ccode\u003eax\u003c/code\u003e will store the result of division, \u003ccode\u003edx\u003c/code\u003e will store the remainder.\u003c/p\u003e\n\u003cp\u003eSo, if we want to check if some 16 bit integer is divisible by 3, we need to do this:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003ePut it into \u003ccode\u003eax\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003ePut 0 into \u003ccode\u003edx\u003c/code\u003e, to make sure value from there does not influence result.\u003c/li\u003e\n\u003cli\u003ePut 3 into \u003ccode\u003ebx\u003c/code\u003e (or \u003ccode\u003ecx\u003c/code\u003e)\u003c/li\u003e\n\u003cli\u003eFinally, call \u003ccode\u003ediv bx\u003c/code\u003e (or \u003ccode\u003ediv cx\u003c/code\u003e)\u003c/li\u003e\n\u003cli\u003eNow check if value in \u003ccode\u003edx\u003c/code\u003e is 0, and jump depending on that.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eUsing this, section of code that prints string addressed by label \u003ccode\u003efizzbuzz\u003c/code\u003e, if \u003ccode\u003eax\u003c/code\u003e is divisible by 15 looks like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-x86asm\"\u003e\t\u003cspan class=\"hljs-keyword\"\u003epush\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eax\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; store ax, because it will be modified\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003edx\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e; div, divides dx:ax number by it's argument, but we want only ax\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; div is not able to work with constants, so use bx to store 15\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e     \u003cspan class=\"hljs-comment\"\u003e; divide dx:ax by bx. After this ax = ax / bx; dx = ax % bx;\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003epop\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eax\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e; restore ax\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003ecmp\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003edx\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e; was it divisible by 15 ? \u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003ejne\u003c/span\u003e check_fizz \u003cspan class=\"hljs-comment\"\u003e; if not - try with 5\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e, fizzbuzz \u003cspan class=\"hljs-comment\"\u003e; if yes - print fizzbuzz\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003ecall\u003c/span\u003e println\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWhile programming in assembly, I feel like I need more registers, and a way to give them better names than just two letters. I miss variables.\u003c/p\u003e\n\u003cp\u003eMaybe people who actually know assembly know how to use memory addresses as variables, I'm instead trying to stick to this 4 general purpose registers.\u003c/p\u003e\n\u003ch2\u003ePrinting decimals\u003c/h2\u003e\n\u003cp\u003eOk, now we are able to print any string by it's address, and we are able to do division. The only thing left is to print decimal numbers.\u003c/p\u003e\n\u003cp\u003eFor that - we just loop over all the digits, and print each. The only hard thing is that it is hard to know with which digit the number starts. It is easier to know with which digit it ends, because it's the remainder of division by 10. The digit that ends our number divided by 10 - is the second digit, etc... We could divide by 10 in each iteration, and get digits in reverse.\u003c/p\u003e\n\u003cp\u003eBut we could push all of them to the stack, and then just pop and print, that would print them in normal order.\u003c/p\u003e\n\u003cp\u003eMy decimal number printing code looks like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-x86asm\"\u003e\u003cspan class=\"hljs-comment\"\u003e; print_decimal routine prints number stored in ax\u003c/span\u003e\n\u003cspan class=\"hljs-symbol\"\u003eprint_decimal:\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003epush\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eax\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; store values of registers that will change\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003epush\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003epush\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ecx\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003epush\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003edx\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ecx\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; cx will hold number of digits, initially 0\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003ecmp\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eax\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; is number we want to print 0? \u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003ejne\u003c/span\u003e push_last_digit \u003cspan class=\"hljs-comment\"\u003e; if not - proceed to pushing last digit of it\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003epush\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; digit is 0\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ecx\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; number of digits in stack is 1\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003ejmp\u003c/span\u003e print_from_stack \u003cspan class=\"hljs-comment\"\u003e; and print this\u003c/span\u003e\n\u003cspan class=\"hljs-symbol\"\u003e\n\tpush_last_digit:\u003c/span\u003e\n\t\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003edx\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e; div, divides dx:ax number by it's argument, but we want only ax\u003c/span\u003e\n\t\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; div is not able to work with constants, so use bx to store 10\u003c/span\u003e\n\t\t\u003cspan class=\"hljs-keyword\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e     \u003cspan class=\"hljs-comment\"\u003e; divide dx:ax by bx. After this ax = ax / bx; dx = ax % bx;\u003c/span\u003e\n\n\t\t\u003cspan class=\"hljs-keyword\"\u003epush\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003edx\u003c/span\u003e   \u003cspan class=\"hljs-comment\"\u003e; dx is last digit, put it in stack\u003c/span\u003e\n\t\t\u003cspan class=\"hljs-keyword\"\u003einc\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ecx\u003c/span\u003e    \u003cspan class=\"hljs-comment\"\u003e; we have one more digit to print\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003ecmp\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eax\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; do we still have numbers?\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003ejne\u003c/span\u003e push_last_digit \u003cspan class=\"hljs-comment\"\u003e; if yes - push that again\u003c/span\u003e\n\u003cspan class=\"hljs-symbol\"\u003e\n\tprint_from_stack:\u003c/span\u003e\n\t\t\u003cspan class=\"hljs-keyword\"\u003ecmp\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ecx\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; are there numbers to print?\u003c/span\u003e\n\t\t\u003cspan class=\"hljs-keyword\"\u003eje\u003c/span\u003e exit_print_decimal\u003cspan class=\"hljs-comment\"\u003e; if no - finish subroutine\u003c/span\u003e\n\n\t\t\u003cspan class=\"hljs-keyword\"\u003epop\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e; put number to print into bx\u003c/span\u003e\n\t\t\u003cspan class=\"hljs-keyword\"\u003eadd\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; add to bx ASCII code of 0\u003c/span\u003e\n\t\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eal\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003ebl\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e; put that code to AL\u003c/span\u003e\n\n\t\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003eah\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0x0e\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e; teletype mode\u003c/span\u003e\n\t\t\u003cspan class=\"hljs-keyword\"\u003eint\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0x10\u003c/span\u003e \t \u003cspan class=\"hljs-comment\"\u003e; print current digit\u003c/span\u003e\n\n\t\t\u003cspan class=\"hljs-keyword\"\u003edec\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ecx\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; and now we have one less digit to print\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003ejmp\u003c/span\u003e print_from_stack\n\u003cspan class=\"hljs-symbol\"\u003e\n\texit_print_decimal:\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eal\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e13\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; print \\r, moves to beginning of line\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003eint\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0x10\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eal\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; print \\n, moves to new line\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003eint\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0x10\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003epop\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003edx\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; restore registers\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003epop\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ecx\u003c/span\u003e \n\t\u003cspan class=\"hljs-keyword\"\u003epop\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e \n\t\u003cspan class=\"hljs-keyword\"\u003epop\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eax\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eret\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eSlowing down\u003c/h2\u003e\n\u003cp\u003eAnd our FizzBuzz runs so fast that it's impossible to read anything, I found out how to ask BIOS to wait for some time:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-x86asm\"\u003e\u003cspan class=\"hljs-comment\"\u003e; sleep about cx/15 seconds\u003c/span\u003e\n\u003cspan class=\"hljs-comment\"\u003e; CX:DX = interval in microseconds, if we don't set dx - one cx is ~65536A microseconds, or 1/15 of second\u003c/span\u003e\n\u003cspan class=\"hljs-symbol\"\u003esleep:\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003epush\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eax\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eal\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003eah\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0x86\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003eint\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0x15\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003epop\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eax\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eret\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eMain FizzBuzz loop\u003c/h2\u003e\n\u003cp\u003eHaving all that subroutines in place, FizzBuzz looks like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-x86asm\"\u003e\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eax\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; loop counter\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ecx\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; how long to sleep in 1/15th of second\u003c/span\u003e\n\u003cspan class=\"hljs-symbol\"\u003e\nloop:\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003einc\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eax\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003ecall\u003c/span\u003e sleep\n\n\t\u003cspan class=\"hljs-keyword\"\u003epush\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eax\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; store ax, because it will be modified\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003edx\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e; div, divides dx:ax number by it's argument, but we want only ax\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; div is not able to work with constants, so use bx to store 15\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e     \u003cspan class=\"hljs-comment\"\u003e; divide dx:ax by bx. After this ax = ax / bx; dx = ax % bx;\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003epop\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eax\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e; restore ax\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003ecmp\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003edx\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e; was it divisible by 15 ? \u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003ejne\u003c/span\u003e check_fizz \u003cspan class=\"hljs-comment\"\u003e; if not - try with 5\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e, fizzbuzz \u003cspan class=\"hljs-comment\"\u003e; if yes - print fizzbuzz\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003ecall\u003c/span\u003e println\n\t\u003cspan class=\"hljs-keyword\"\u003ejmp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eloop\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; continue with next iteration\u003c/span\u003e\n\u003cspan class=\"hljs-symbol\"\u003e\n\tcheck_fizz:\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003epush\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eax\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003edx\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003epop\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eax\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003ecmp\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003edx\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e; was it divisible by 5 ? \u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003ejne\u003c/span\u003e check_buzz \u003cspan class=\"hljs-comment\"\u003e; if not - try with 3\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e, fizz \u003cspan class=\"hljs-comment\"\u003e; if yes - print fizz\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003ecall\u003c/span\u003e println\n\n\t\u003cspan class=\"hljs-keyword\"\u003ejmp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eloop\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e; and move to next number\u003c/span\u003e\n\u003cspan class=\"hljs-symbol\"\u003e\n\tcheck_buzz:\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003epush\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eax\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003edx\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003epop\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eax\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003ecmp\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003edx\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e; was it divisible by 3 ? \u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003ejne\u003c/span\u003e integer \u003cspan class=\"hljs-comment\"\u003e; not - proceed to printing\u003c/span\u003e\n\n\t\u003cspan class=\"hljs-keyword\"\u003emov\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ebx\u003c/span\u003e, buzz \u003cspan class=\"hljs-comment\"\u003e; if yes - print fizz\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003ecall\u003c/span\u003e println\n\n\t\u003cspan class=\"hljs-keyword\"\u003ejmp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eloop\u003c/span\u003e\n\u003cspan class=\"hljs-symbol\"\u003e\n\tinteger:\u003c/span\u003e\n\t\u003cspan class=\"hljs-keyword\"\u003ecall\u003c/span\u003e print_decimal\n\u003cspan class=\"hljs-keyword\"\u003ejmp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eloop\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOverall code with all the subroutines, constants, and comments takes me 172 lines. A lot for a FizzBuzz, but in Python you would not write two \"print\" functions for two data types from scratch.\u003c/p\u003e\n\u003cp\u003eIf I remove padding with zeroes, it no longer runs, but binary has just a little over 200 bytes. So, even with my poor assembly skills FizzBuzz could fit into 512 bytes bootsector twice.\u003c/p\u003e"},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"bare_metal_fizz_buzz"},"buildId":"MGOI-P4iVCBMhDsEh3Q1E","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>