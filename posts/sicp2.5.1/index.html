<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>SICP 2.5.1 Generic arithmetic operations</title>
	<meta name="description" content="">
	<meta name="generator" content="Hugo 0.48-DEV" />
	
	
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/style.css">
	<script type="text/javascript" src="/js/scripts.js"></script>
	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo" role="banner">
			<a class="logo__link" href="/" title="Bunyk Taras" rel="home">
				<div class="logo__title">Bunyk Taras</div>
				
			</a>
		</div>
	</div>
	
<nav class="menu">
	<ul class="menu__list">
		<li class="menu__item"><a class="menu__link" href="/">HOME</a></li>
		<li class="menu__item"><a class="menu__link" href="/resume/">RESUME</a></li>
		<li class="menu__item"><a class="menu__link" href="https://bunyk.wordpress.com/">OLD BLOG</a></li>
	</ul>
</nav>

</header>
		<div class="wrapper flex">
			<section class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SICP 2.5.1 Generic arithmetic operations</h1><div class="post__meta meta">
<svg class="icon icon-time" width="16" height="14" viewBox="0 0 16 16"><path d="m8-.0000003c-4.4 0-8 3.6-8 8 0 4.4000003 3.6 8.0000003 8 8.0000003 4.4 0 8-3.6 8-8.0000003 0-4.4-3.6-8-8-8zm0 14.4000003c-3.52 0-6.4-2.88-6.4-6.4000003 0-3.52 2.88-6.4 6.4-6.4 3.52 0 6.4 2.88 6.4 6.4 0 3.5200003-2.88 6.4000003-6.4 6.4000003zm.4-10.4000003h-1.2v4.8l4.16 2.5600003.64-1.04-3.6-2.1600003z"/></svg>
<time class="post__meta-date meta-date" datetime="2020-09-02T19:27:13">September 02, 2020</time></div>
		</header><div class="content post__content clearfix">
			<p>In <a href="/posts/sicp2.4/">previous post</a> I have used wrong StackOverflow answer. :) Or, to be more precise, right answer for that section, but useless here, as we want to store in table functions for multiple arguments.</p>

<p><a href="https://stackoverflow.com/a/19114031/816449">Correct answer</a> that supports lists looks like this:
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(<span style="color:#66d9ef">define </span>*op-table* (make-hash-table))

(<span style="color:#66d9ef">define </span>(put op type proc)
  (hash-table/put! *op-table* (list op type) proc))

(<span style="color:#66d9ef">define </span>(get op type)
  (hash-table/get *op-table* (list op type) <span style="color:#66d9ef">#f</span>))</code></pre></div></p>

<p></p>

<p>Also I needed to copypaste a lot of code to be able to start working on <a href="#exercise-2-77">first exercise</a>:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(<span style="color:#66d9ef">define </span>(attach-tag type-tag contents)
  (cons type-tag contents))
(<span style="color:#66d9ef">define </span>(type-tag datum)
  (<span style="color:#66d9ef">if </span>(pair? datum)
      (car datum)
      (error <span style="color:#e6db74">&#34;Bad tagged datum -- TYPE-TAG&#34;</span> datum)))
(<span style="color:#66d9ef">define </span>(contents datum)
  (<span style="color:#66d9ef">if </span>(pair? datum)
      (cdr datum)
      (error <span style="color:#e6db74">&#34;Bad tagged datum -- CONTENTS&#34;</span> datum)))

(<span style="color:#66d9ef">define </span>(apply-generic op <span style="color:#f92672">.</span> args)
  (<span style="color:#66d9ef">let </span>((type-tags (map type-tag args)))
    (<span style="color:#66d9ef">let </span>((proc (get op type-tags)))
      (<span style="color:#66d9ef">if </span>proc
          (apply proc (map contents args))
          (error
            <span style="color:#e6db74">&#34;No method for these types -- APPLY-GENERIC&#34;</span>
            (list op type-tags))))))

(<span style="color:#66d9ef">define </span>(real-part z) (apply-generic <span style="color:#e6db74">&#39;real-part</span> z))
(<span style="color:#66d9ef">define </span>(imag-part z) (apply-generic <span style="color:#e6db74">&#39;imag-part</span> z))
(<span style="color:#66d9ef">define </span>(magnitude z) (apply-generic <span style="color:#e6db74">&#39;magnitude</span> z))
(<span style="color:#66d9ef">define </span>(angle z) (apply-generic <span style="color:#e6db74">&#39;angle</span> z))



(<span style="color:#66d9ef">define </span>(install-rectangular-package)
  <span style="color:#75715e">;; internal procedures</span>
  (<span style="color:#66d9ef">define </span>(real-part z) (car z))
  (<span style="color:#66d9ef">define </span>(imag-part z) (cdr z))
  (<span style="color:#66d9ef">define </span>(make-from-real-imag x y) (cons x y))
  (<span style="color:#66d9ef">define </span>(magnitude z)
    (sqrt (+ (square (real-part z))
             (square (imag-part z)))))
  (<span style="color:#66d9ef">define </span>(angle z)
    (atan (imag-part z) (real-part z)))
  (<span style="color:#66d9ef">define </span>(make-from-mag-ang r a) 
    (cons (* r (cos a)) (* r (sin a))))
  <span style="color:#75715e">;; interface to the rest of the system</span>
  (<span style="color:#66d9ef">define </span>(tag x) (attach-tag <span style="color:#e6db74">&#39;rectangular</span> x))
  (put <span style="color:#e6db74">&#39;real-part</span> <span style="color:#f92672">&#39;</span>(rectangular) real-part)
  (put <span style="color:#e6db74">&#39;imag-part</span> <span style="color:#f92672">&#39;</span>(rectangular) imag-part)
  (put <span style="color:#e6db74">&#39;magnitude</span> <span style="color:#f92672">&#39;</span>(rectangular) magnitude)
  (put <span style="color:#e6db74">&#39;angle</span> <span style="color:#f92672">&#39;</span>(rectangular) angle)
  (put <span style="color:#e6db74">&#39;make-from-real-imag</span> <span style="color:#e6db74">&#39;rectangular</span> 
       (<span style="color:#66d9ef">lambda </span>(x y) (tag (make-from-real-imag x y))))
  (put <span style="color:#e6db74">&#39;make-from-mag-ang</span> <span style="color:#e6db74">&#39;rectangular</span> 
       (<span style="color:#66d9ef">lambda </span>(r a) (tag (make-from-mag-ang r a))))
  <span style="color:#e6db74">&#39;done</span>)
(install-rectangular-package)

(<span style="color:#66d9ef">define </span>(install-polar-package)
  <span style="color:#75715e">;; internal procedures</span>
  (<span style="color:#66d9ef">define </span>(magnitude z) (car z))
  (<span style="color:#66d9ef">define </span>(angle z) (cdr z))
  (<span style="color:#66d9ef">define </span>(make-from-mag-ang r a) (cons r a))
  (<span style="color:#66d9ef">define </span>(real-part z)
    (* (magnitude z) (cos (angle z))))
  (<span style="color:#66d9ef">define </span>(imag-part z)
    (* (magnitude z) (sin (angle z))))
  (<span style="color:#66d9ef">define </span>(make-from-real-imag x y) 
    (cons (sqrt (+ (square x) (square y)))
          (atan y x)))
  <span style="color:#75715e">;; interface to the rest of the system</span>
  (<span style="color:#66d9ef">define </span>(tag x) (attach-tag <span style="color:#e6db74">&#39;polar</span> x))
  (put <span style="color:#e6db74">&#39;real-part</span> <span style="color:#f92672">&#39;</span>(polar) real-part)
  (put <span style="color:#e6db74">&#39;imag-part</span> <span style="color:#f92672">&#39;</span>(polar) imag-part)
  (put <span style="color:#e6db74">&#39;magnitude</span> <span style="color:#f92672">&#39;</span>(polar) magnitude)
  (put <span style="color:#e6db74">&#39;angle</span> <span style="color:#f92672">&#39;</span>(polar) angle)
  (put <span style="color:#e6db74">&#39;make-from-real-imag</span> <span style="color:#e6db74">&#39;polar</span>
       (<span style="color:#66d9ef">lambda </span>(x y) (tag (make-from-real-imag x y))))
  (put <span style="color:#e6db74">&#39;make-from-mag-ang</span> <span style="color:#e6db74">&#39;polar</span> 
       (<span style="color:#66d9ef">lambda </span>(r a) (tag (make-from-mag-ang r a))))
  <span style="color:#e6db74">&#39;done</span>)
(install-rectangular-package)

(<span style="color:#66d9ef">define </span>(install-complex-package)
  <span style="color:#75715e">;; imported procedures from rectangular and polar packages</span>
  (<span style="color:#66d9ef">define </span>(make-from-real-imag x y)
    ((get <span style="color:#e6db74">&#39;make-from-real-imag</span> <span style="color:#e6db74">&#39;rectangular</span>) x y))
  (<span style="color:#66d9ef">define </span>(make-from-mag-ang r a)
    ((get <span style="color:#e6db74">&#39;make-from-mag-ang</span> <span style="color:#e6db74">&#39;polar</span>) r a))
  <span style="color:#75715e">;; internal procedures</span>
  (<span style="color:#66d9ef">define </span>(add-complex z1 z2)
    (make-from-real-imag (+ (real-part z1) (real-part z2))
                         (+ (imag-part z1) (imag-part z2))))
  (<span style="color:#66d9ef">define </span>(sub-complex z1 z2)
    (make-from-real-imag (- (real-part z1) (real-part z2))
                         (- (imag-part z1) (imag-part z2))))
  (<span style="color:#66d9ef">define </span>(mul-complex z1 z2)
    (make-from-mag-ang (* (magnitude z1) (magnitude z2))
                       (+ (angle z1) (angle z2))))
  (<span style="color:#66d9ef">define </span>(div-complex z1 z2)
    (make-from-mag-ang (/ (magnitude z1) (magnitude z2))
                       (- (angle z1) (angle z2))))
  <span style="color:#75715e">;; interface to rest of the system</span>
  (<span style="color:#66d9ef">define </span>(tag z) (attach-tag <span style="color:#e6db74">&#39;complex</span> z))
  (put <span style="color:#e6db74">&#39;add</span> <span style="color:#f92672">&#39;</span>(complex complex)
       (<span style="color:#66d9ef">lambda </span>(z1 z2) (tag (add-complex z1 z2))))
  (put <span style="color:#e6db74">&#39;sub</span> <span style="color:#f92672">&#39;</span>(complex complex)
       (<span style="color:#66d9ef">lambda </span>(z1 z2) (tag (sub-complex z1 z2))))
  (put <span style="color:#e6db74">&#39;mul</span> <span style="color:#f92672">&#39;</span>(complex complex)
       (<span style="color:#66d9ef">lambda </span>(z1 z2) (tag (mul-complex z1 z2))))
  (put <span style="color:#e6db74">&#39;div</span> <span style="color:#f92672">&#39;</span>(complex complex)
       (<span style="color:#66d9ef">lambda </span>(z1 z2) (tag (div-complex z1 z2))))
  (put <span style="color:#e6db74">&#39;make-from-real-imag</span> <span style="color:#e6db74">&#39;complex</span>
       (<span style="color:#66d9ef">lambda </span>(x y) (tag (make-from-real-imag x y))))
  (put <span style="color:#e6db74">&#39;make-from-mag-ang</span> <span style="color:#e6db74">&#39;complex</span>
       (<span style="color:#66d9ef">lambda </span>(r a) (tag (make-from-mag-ang r a))))
  (put <span style="color:#e6db74">&#39;real-part</span> <span style="color:#f92672">&#39;</span>(complex) real-part)
  (put <span style="color:#e6db74">&#39;imag-part</span> <span style="color:#f92672">&#39;</span>(complex) imag-part)
  (put <span style="color:#e6db74">&#39;magnitude</span> <span style="color:#f92672">&#39;</span>(complex) magnitude)
  (put <span style="color:#e6db74">&#39;angle</span> <span style="color:#f92672">&#39;</span>(complex) angle)
  <span style="color:#e6db74">&#39;done</span>)
(install-complex-package)</code></pre></div>

<h2 id="exercise-2-77">Exercise 2.77</h2>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(<span style="color:#66d9ef">define </span>z (cons <span style="color:#e6db74">&#39;complex</span> (cons <span style="color:#e6db74">&#39;rectangular</span> (cons <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">4</span>))))

(magnitude z)</code></pre></div>

<p>It calls <code>apply-generic</code> to do operation <code>'magnitude</code> with z</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(apply-generic <span style="color:#e6db74">&#39;magnitude</span> (cons <span style="color:#e6db74">&#39;complex</span> (cons <span style="color:#e6db74">&#39;rectangular</span> (cons <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">4</span>))))</code></pre></div>

<p><code>apply-generic</code> looks for operation <code>'magnitude</code> for <code>'complex</code> numbers, and applies it to value inside</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(apply (get <span style="color:#e6db74">&#39;magnitude</span> <span style="color:#e6db74">&#39;complex</span>) (cons <span style="color:#e6db74">&#39;rectangular</span> (cons <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">4</span>)))</code></pre></div>

<p>That operation, thanks to Alyssa P. Hacker, is just application of same <code>magnitude</code> function, but this time for <code>'rectangular</code> object</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(magnitude (cons <span style="color:#e6db74">&#39;rectangular</span> (cons <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">4</span>)))</code></pre></div>

<p>apply-generic applies operation &lsquo;magnitude for &lsquo;rectangular type to content of rectangular &ldquo;package&rdquo;:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(apply (get <span style="color:#e6db74">&#39;magnitude</span> <span style="color:#e6db74">&#39;rectangular</span>) (cons <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">4</span>))</code></pre></div>

<p>which is <code>magnitude</code> function from inside rectangular package</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(magnitude (cons <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">4</span>))
(sqrt (+ (square <span style="color:#ae81ff">3</span>)
         (square <span style="color:#ae81ff">4</span>)))
<span style="color:#ae81ff">5</span></code></pre></div>

<h2 id="exercise-2-78">Exercise 2.78</h2>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(<span style="color:#66d9ef">define </span>(attach-tag type-tag contents)
  (<span style="color:#66d9ef">if </span>(eq? type-tag <span style="color:#e6db74">&#39;scheme-number</span>)
    contents
    (cons type-tag contents)
  )
)
(<span style="color:#66d9ef">define </span>(type-tag datum)
  (cond
    ((number? datum) <span style="color:#e6db74">&#39;scheme-number</span>)
    ((pair? datum) (car datum))
    (<span style="color:#66d9ef">else </span>(error <span style="color:#e6db74">&#34;Bad tagged datum -- TYPE-TAG&#34;</span> datum))
  )
)
(<span style="color:#66d9ef">define </span>(contents datum)
  (cond
    ((number? datum) datum)
    ((pair? datum) (cdr datum))
    (<span style="color:#66d9ef">else </span>(error <span style="color:#e6db74">&#34;Bad tagged datum -- CONTENTS&#34;</span> datum))
  )
)</code></pre></div>

<p>To test:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(<span style="color:#66d9ef">define </span>(add x y) (apply-generic <span style="color:#e6db74">&#39;add</span> x y))
(<span style="color:#66d9ef">define </span>(sub x y) (apply-generic <span style="color:#e6db74">&#39;sub</span> x y))
(<span style="color:#66d9ef">define </span>(mul x y) (apply-generic <span style="color:#e6db74">&#39;mul</span> x y))
(<span style="color:#66d9ef">define </span>(div x y) (apply-generic <span style="color:#e6db74">&#39;div</span> x y))

(<span style="color:#66d9ef">define </span>(install-scheme-number-package)
  (<span style="color:#66d9ef">define </span>(tag x)
    (attach-tag <span style="color:#e6db74">&#39;scheme-number</span> x))    
  (put <span style="color:#e6db74">&#39;add</span> <span style="color:#f92672">&#39;</span>(scheme-number scheme-number)
       (<span style="color:#66d9ef">lambda </span>(x y) (tag (+ x y))))
  (put <span style="color:#e6db74">&#39;sub</span> <span style="color:#f92672">&#39;</span>(scheme-number scheme-number)
       (<span style="color:#66d9ef">lambda </span>(x y) (tag (- x y))))
  (put <span style="color:#e6db74">&#39;mul</span> <span style="color:#f92672">&#39;</span>(scheme-number scheme-number)
       (<span style="color:#66d9ef">lambda </span>(x y) (tag (* x y))))
  (put <span style="color:#e6db74">&#39;div</span> <span style="color:#f92672">&#39;</span>(scheme-number scheme-number)
       (<span style="color:#66d9ef">lambda </span>(x y) (tag (/ x y))))
  (put <span style="color:#e6db74">&#39;make</span> <span style="color:#e6db74">&#39;scheme-number</span>
       (<span style="color:#66d9ef">lambda </span>(x) (tag x)))
  <span style="color:#e6db74">&#39;done</span>)
(install-scheme-number-package)</code></pre></div>

<h2 id="exercise-2-79">Exercise 2.79</h2>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(put <span style="color:#e6db74">&#39;equ?</span> <span style="color:#f92672">&#39;</span>(scheme-number scheme-number) =)

(put <span style="color:#e6db74">&#39;equ?</span> <span style="color:#f92672">&#39;</span>(complex complex)
     (<span style="color:#66d9ef">lambda </span>(x y) (and
        (= (real-part x) (real-part y))
        (= (imag-part x) (imag-part y))
    ))
)
(<span style="color:#66d9ef">define </span>(equ? x y) (apply-generic <span style="color:#e6db74">&#39;equ?</span> x y))</code></pre></div>

<h2 id="exercise-2-80">Exercise 2.80</h2>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scheme" data-lang="scheme">(put <span style="color:#e6db74">&#39;zero?</span> <span style="color:#f92672">&#39;</span>(scheme-number)
     (<span style="color:#66d9ef">lambda </span>(x) (= x <span style="color:#ae81ff">0</span>))
)
(put <span style="color:#e6db74">&#39;zero?</span> <span style="color:#f92672">&#39;</span>(complex)
     (<span style="color:#66d9ef">lambda </span>(x) (= (magnitude x) <span style="color:#ae81ff">0</span>))
)
(<span style="color:#66d9ef">define </span>(zero? x) (apply-generic <span style="color:#e6db74">&#39;zero?</span> x))</code></pre></div>
		</div>
		
<div class="post__tags tags clearfix">
	<svg class="icon icon-tag" width="16" height="16" viewBox="0 0 16 16"><path d="M16 9.5c0 .373-.24.74-.5 1l-5 5c-.275.26-.634.5-1 .5-.373 0-.74-.24-1-.5L1 8a2.853 2.853 0 0 1-.7-1C.113 6.55 0 5.973 0 5.6V1.4C0 1.034.134.669.401.401.67.134 1.034 0 1.4 0h4.2c.373 0 .95.113 1.4.3.45.187.732.432 1 .7l7.5 7.502c.26.274.5.632.5.998zM3.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"/></svg>
	<ul class="tags__list">
		<li class="tags__item"><a class="tags__link btn" href="/tags/sicp/" rel="tag">SICP</a></li>
	</ul>
</div>
	</article>
</main>




			</section>
			
		</div>
		<footer class="footer">
	<div class="container">
		<div class="footer__copyright">&copy; 2020 Bunyk Taras. <span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span></div>
	</div>
</footer>
	</div>
<script>
	var navigation = responsiveNav(".menu", {
		navClass: "menu--collapse",
		label: "Menu",
	});
</script></body>
</html>
